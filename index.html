<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Улучшенная игра TON CRASH с новыми функциями</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Orbitron', monospace;
            background: linear-gradient(135deg, rgb(20, 20, 20) 0%, rgb(40, 40, 40) 50%, rgb(30, 30, 30) 100%);
            color: white;
            overflow-x: hidden;
            min-height: 100vh;
            padding: 20px;
            /* Объёмный шрифт для всего текста */
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8), 0 0 10px rgba(255, 255, 255, 0.1);
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            position: relative;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            background: rgba(30, 30, 30, 0.9);
            padding: 20px;
            border-radius: 30px;
            border: 2px solid #00aaff;
            backdrop-filter: blur(10px);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo img {
            height: 50px;
            width: auto;
        }

        .header-center {
            display: flex;
            align-items: center;
            gap: 20px;
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
        }

        .nav-button {
            padding: 15px 30px;
            background: rgba(30, 30, 30, 0.9);
            border: 2px solid #00aaff;
            border-radius: 25px;
            color: white;
            font-family: 'Orbitron', monospace;
            font-weight: 700;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            text-transform: none;
        }

        .nav-button.active {
            background: linear-gradient(45deg, #00aaff, #66ccff);
            color: #000;
            box-shadow: 0 5px 20px rgba(0, 170, 255, 0.4);
        }

        .nav-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 170, 255, 0.3);
        }

        .balance-container {
            display: flex;
            align-items: center;
            gap: 15px;
            background: rgba(30, 30, 30, 0.9);
            padding: 15px 25px;
            border-radius: 30px;
            border: 2px solid #00aaff;
            position: relative;
            overflow: hidden;
        }

        .balance-container::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(0, 170, 255, 0.1), transparent);
            animation: balanceGlow 3s linear infinite;
        }

        @keyframes balanceGlow {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .balance-logo {
            width: 40px;
            height: 40px;
            background: linear-gradient(45deg, #00aaff, #66ccff);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 900;
            font-size: 1.2rem;
            color: #000;
            position: relative;
            z-index: 2;
        }

        .ton-icon {
            width: 24px;
            height: 24px;
        }

        .balance-amount {
            font-size: 1.5rem;
            font-weight: 700;
            position: relative;
            z-index: 2;
            display: flex;
            align-items: center;
            gap: 8px;
            color: white;
            cursor: pointer;
        }

        .balance-amount:hover {
            transform: scale(1.05);
            transition: transform 0.2s ease;
        }

        .balance-blurred {
            filter: blur(8px);
            user-select: none;
        }

        .login-overlay {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 10;
        }

        .login-btn {
            background: #c72626;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 20px;
            font-family: 'Orbitron', monospace;
            font-weight: 900;
            font-size: 1rem;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(199, 38, 38, 0.3);
            transition: all 0.3s ease;
            letter-spacing: 1px;
            text-transform: none;
        }

        .login-btn:hover {
            background: #a31e1e;
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(199, 38, 38, 0.5);
        }

        .balance-buttons {
            display: flex;
            gap: 10px;
            margin-top: 10px;
            position: relative;
            z-index: 2;
            align-items: center;
        }

        .balance-button {
            background: #56bd46;
            color: #fff;
            border: none;
            padding: 8px 16px;
            border-radius: 15px;
            font-family: 'Orbitron', monospace;
            font-weight: 700;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: none;
        }

        .balance-button:hover {
            background: #4aa83a;
            transform: translateY(-1px);
        }

        .balance-button.deposit {
            background: #56bd46;
            color: #fff;
        }

        .balance-button.deposit:hover {
            background: #4aa83a;
            transform: translateY(-1px);
        }

        .menu-button {
            background: #808080;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 15px;
            font-family: 'Orbitron', monospace;
            font-weight: 700;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .menu-button:hover {
            background: #909090;
            transform: translateY(-1px);
        }

        .dropdown-menu {
            position: absolute;
            top: 100%;
            right: 0;
            background: rgba(30, 30, 30, 0.95);
            border: 2px solid #808080;
            border-radius: 15px;
            padding: 10px;
            display: none;
            flex-direction: column;
            gap: 8px;
            min-width: 150px;
            z-index: 99999;
            backdrop-filter: blur(10px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.8);
        }

        .dropdown-menu.show {
            display: flex;
        }

        .dropdown-item {
            background: #808080;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 10px;
            font-family: 'Orbitron', monospace;
            font-weight: 700;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: left;
            text-transform: none;
        }

        .dropdown-item:hover {
            background: #909090;
            transform: translateY(-1px);
        }

        .content-slider {
            position: relative;
            overflow: hidden;
            width: 100%;
        }

        .slider-container {
            display: flex;
            transition: transform 0.5s ease-in-out;
            width: 300%;
        }

        .slide {
            width: 33.333%;
            flex-shrink: 0;
        }

        .main-content {
            display: grid;
            grid-template-columns: 320px 1fr 420px;
            gap: 30px;
            height: 720px;
            overflow: visible;
        }

        .bonus-content {
            padding: 20px;
            background: rgba(30, 30, 30, 0.9);
            border-radius: 30px;
            border: 2px solid #00aaff;
            margin: 0 auto;
            max-width: 800px;
            overflow-y: auto;
            max-height: 80vh;
            /* Убираем полосу прокрутки */
            scrollbar-width: none; /* Firefox */
            -ms-overflow-style: none; /* IE и Edge */
        }

        /* Убираем полосу прокрутки для WebKit браузеров */
        .bonus-content::-webkit-scrollbar {
            display: none;
        }

        .wallet-content {
            padding: 30px;
            background: rgba(40, 40, 40, 0.9);
            border-radius: 30px;
            border: 2px solid #666;
            margin: 0 auto;
            max-width: 600px;
            position: relative;
            overflow: hidden;
        }

        .wallet-content::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="20" cy="20" r="3" fill="%23ffffff" opacity="0.1"/><circle cx="80" cy="30" r="2" fill="%23ffffff" opacity="0.1"/><circle cx="60" cy="70" r="4" fill="%23ffffff" opacity="0.1"/><circle cx="30" cy="80" r="2.5" fill="%23ffffff" opacity="0.1"/><circle cx="90" cy="60" r="3.5" fill="%23ffffff" opacity="0.1"/></svg>'),
                url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><path d="M10 20 Q 30 10, 50 20 T 90 20" stroke="%23ffffff" opacity="0.05" fill="none" stroke-width="1"/><path d="M10 60 Q 50 50, 90 60" stroke="%23ffffff" opacity="0.05" fill="none" stroke-width="1"/></svg>');
            background-size: 200px 200px, 300px 150px;
            animation: floatStickers 20s linear infinite;
            pointer-events: none;
            z-index: 0;
        }

        @keyframes floatStickers {
            0% { transform: translate(0, 0); }
            100% { transform: translate(-50px, -20px); }
        }

        .wallet-title {
            text-align: center;
            font-size: 2.5rem;
            font-weight: 900;
            color: white;
            margin-bottom: 30px;
            position: relative;
            z-index: 2;
            text-transform: none;
        }

        .wallet-balance {
            text-align: center;
            margin-bottom: 30px;
            position: relative;
            z-index: 2;
        }

        .wallet-balance-main {
            font-size: 3rem;
            font-weight: 900;
            color: white;
            margin-bottom: 10px;
            position: relative;
            background: rgba(0, 0, 0, 0.3);
            padding: 15px 25px;
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(5px);
        }

        .wallet-balance-usd {
            font-size: 1.5rem;
            color: #aaa;
            font-weight: 400;
        }

        .wallet-buttons {
            display: flex;
            gap: 20px;
            margin-bottom: 40px;
            position: relative;
            z-index: 2;
        }

        .wallet-button {
            flex: 1;
            padding: 20px;
            border: none;
            border-radius: 20px;
            font-family: 'Orbitron', monospace;
            font-weight: 700;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            text-transform: none;
        }

        .wallet-button.deposit {
            background: rgba(86, 189, 70, 0.4);
            color: white;
            border: 2px solid rgba(86, 189, 70, 0.6);
        }

        .wallet-button.deposit:hover {
            background: rgba(86, 189, 70, 0.6);
            transform: translateY(-2px);
        }

        .wallet-button.withdraw {
            background: rgba(128, 128, 128, 0.4);
            color: white;
            border: 2px solid rgba(128, 128, 128, 0.6);
        }

        .wallet-button.withdraw:hover {
            background: rgba(128, 128, 128, 0.6);
            transform: translateY(-2px);
        }

        .crypto-list {
            position: relative;
            z-index: 2;
        }

        .crypto-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(0, 0, 0, 0.3);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 15px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .crypto-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .crypto-icon {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 900;
            overflow: hidden;
        }

        .crypto-icon img {
            width: 30px;
            height: 30px;
            object-fit: contain;
        }

        .crypto-name {
            font-weight: 700;
            font-size: 1.1rem;
        }

        .crypto-balance {
            text-align: right;
        }

        .crypto-amount {
            font-weight: 700;
            font-size: 1.1rem;
        }

        .crypto-usd {
            color: #aaa;
            font-size: 0.9rem;
        }

        .bonus-title {
            text-align: center;
            font-size: 2.5rem;
            font-weight: 900;
            color: white;
            margin-bottom: 30px;
            text-transform: none;
            /* Объёмный шрифт как у PEPE */
            text-shadow: 3px 3px 6px rgba(0, 0, 0, 0.9), 0 0 15px rgba(255, 255, 255, 0.2);
        }

        .bonus-stages {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .bonus-stage {
            background: rgba(0, 0, 0, 0.5);
            border: 2px solid rgba(100, 100, 100, 0.3);
            border-radius: 25px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s ease;
            opacity: 0.4;
            position: relative;
            overflow: hidden;
        }

        .bonus-stage.active {
            background: linear-gradient(45deg, rgba(0, 170, 255, 0.2), rgba(0, 170, 255, 0.1));
            border-color: #00aaff;
            opacity: 1;
            box-shadow: 0 0 30px rgba(0, 170, 255, 0.3);
        }

        .bonus-stage.completed {
            background: linear-gradient(45deg, rgba(0, 255, 0, 0.2), rgba(0, 255, 0, 0.1));
            border-color: #00ff00;
            opacity: 1;
        }

        .bonus-stage::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255, 215, 0, 0.1), transparent);
            animation: bonusGlow 4s linear infinite;
            opacity: 0;
        }

        .bonus-stage.active::before {
            opacity: 1;
        }

        @keyframes bonusGlow {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .bonus-stage-number {
            font-size: 1.5rem;
            font-weight: 900;
            color: white;
            margin-bottom: 10px;
            position: relative;
            z-index: 2;
            text-transform: none;
        }

        .bonus-stage.active .bonus-stage-number {
            color: #ffaa00;
        }

        .bonus-stage.completed .bonus-stage-number {
            color: #00ff00;
        }

        .bonus-percentage {
            font-size: 2rem;
            font-weight: 900;
            margin-bottom: 10px;
            position: relative;
            z-index: 2;
            color: white;
        }

        .bonus-stage.active .bonus-percentage {
            color: #ffaa00;
        }

        .bonus-stage.completed .bonus-percentage {
            color: #00ff00;
        }

        .bonus-description {
            font-size: 0.9rem;
            opacity: 0.8;
            position: relative;
            z-index: 2;
            color: white;
            text-transform: none;
        }

        .bonus-info {
            background: rgba(0, 0, 0, 0.7);
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 30px;
        }

        .bonus-progress {
            text-align: center;
            margin-bottom: 20px;
        }

        .bonus-progress-text {
            font-size: 1.2rem;
            color: white;
            margin-bottom: 15px;
            text-transform: none;
        }

        .bonus-progress-bar {
            width: 100%;
            height: 10px;
            background: rgba(100, 100, 100, 0.3);
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 15px;
        }

        .bonus-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #00aaff, #ffaa00);
            border-radius: 10px;
            transition: width 0.3s ease;
        }

        .bonus-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            text-align: center;
        }

        .bonus-stat {
            background: rgba(0, 170, 255, 0.1);
            padding: 15px;
            border-radius: 15px;
            border: 1px solid rgba(0, 170, 255, 0.3);
        }

        .bonus-stat-value {
            font-size: 1.5rem;
            font-weight: 900;
            color: white;
        }

        .bonus-stat-label {
            font-size: 0.9rem;
            opacity: 0.8;
            margin-top: 5px;
            color: white;
            text-transform: none;
        }

        /* Новый блок конкурса PEPE */
        .pepe-contest {
            background: rgba(128, 128, 128, 0.3);
            border-radius: 25px;
            padding: 30px;
            margin-bottom: 30px;
            display: flex;
            align-items: center;
            gap: 20px;
            border: 2px solid rgba(128, 128, 128, 0.5);
        }

        .pepe-contest-image {
            width: 120px;
            height: 120px;
            border-radius: 15px;
            object-fit: cover;
        }

        .pepe-contest-content {
            flex: 1;
            text-align: center;
        }

        .pepe-contest-title {
            font-size: 2rem;
            font-weight: 900;
            color: white;
            margin-bottom: 20px;
            text-transform: none;
            /* Объёмный шрифт как у PEPE */
            text-shadow: 3px 3px 6px rgba(0, 0, 0, 0.9), 0 0 15px rgba(255, 255, 255, 0.2);
        }

        .pepe-contest-button {
            background: #56bd46;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 20px;
            font-family: 'Orbitron', monospace;
            font-weight: 700;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: none;
        }

        .pepe-contest-button:hover {
            background: #4aa83a;
            transform: translateY(-2px);
        }

        .online-panel {
            background: rgba(30, 30, 30, 0.9);
            border-radius: 25px;
            border: 2px solid #00aaff;
            padding: 15px;
            backdrop-filter: blur(10px);
            width: 150px;
            height: 80px;
            position: absolute;
            left: 0;
            top: 50%;
            transform: translateY(-50%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .online-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .online-dot {
            width: 12px;
            height: 12px;
            background: #00ff00;
            border-radius: 50%;
            animation: blink 1.5s infinite;
        }

        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0.3; }
        }

        .online-text {
            font-size: 0.8rem;
            color: white;
            font-weight: 700;
            text-transform: none;
            /* Убираем объёмный эффект для игроков */
            text-shadow: none;
        }

        .online-count {
            font-size: 1.2rem;
            color: white;
            font-weight: 900;
            /* Убираем объёмный эффект для игроков */
            text-shadow: none;
        }

        .players-panel {
            background: rgba(30, 30, 30, 0.9);
            border-radius: 25px;
            border: 2px solid #00aaff;
            padding: 20px;
            backdrop-filter: blur(10px);
            max-height: 720px;
            overflow: hidden;
            position: relative;
        }

        /* Кнопка отмены ставки в панели игроков */
        .cancel-bet-button {
            background: linear-gradient(45deg, #ff4444, #ff6666);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 15px;
            font-family: 'Orbitron', monospace;
            font-weight: 700;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: none;
            margin-bottom: 15px;
            width: 100%;
            display: none;
            /* Убираем объёмный эффект для кнопки отмены */
            text-shadow: none;
        }

        .cancel-bet-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 68, 68, 0.4);
        }

        .cancel-bet-button.show {
            display: block;
        }

        /* Затемнение внизу панели игроков */
        .players-panel::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 60px;
            background: linear-gradient(transparent, rgba(30, 30, 30, 0.9));
            pointer-events: none;
            z-index: 10;
        }

        .players-title {
            font-weight: 700;
            margin-bottom: 20px;
            color: white;
            text-align: center;
            font-size: 1.2rem;
            text-transform: none;
            /* Убираем объёмный эффект для игроков */
            text-shadow: none;
        }

        .player-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px 15px;
            margin-bottom: 8px;
            background: rgba(0, 170, 255, 0.1);
            border-radius: 15px;
            border: 1px solid rgba(0, 170, 255, 0.3);
            font-size: 0.9rem;
            position: relative;
            transition: all 0.3s ease;
            opacity: 0;
            transform: translateY(20px);
            animation: playerSlideIn 0.5s ease-out forwards;
            min-height: 50px;
        }

        @keyframes playerSlideIn {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .player-item.user {
            background: rgba(255, 170, 0, 0.2);
            border: 2px solid #ffaa00;
            order: -1;
            margin-bottom: 10px;
        }

        .player-item.lost {
            background: rgba(255, 68, 68, 0.2);
            border-color: #ff4444;
            color: #ff9999;
        }

        .player-item.won {
            background: rgba(28, 191, 25, 0.2);
            border-color: #1cbf19;
            position: relative;
        }

        .player-item.won::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(28, 191, 25, 0.1);
            border-radius: 15px;
            pointer-events: none;
        }

        .player-info {
            flex: 1;
            display: flex;
            justify-content: space-between;
            align-items: center;
            white-space: nowrap;
            min-width: 0;
        }

        .player-name {
            font-size: 0.9rem;
            font-weight: 700;
            color: white;
            flex-shrink: 0;
            width: 80px;
            overflow: hidden;
            text-overflow: ellipsis;
            text-transform: none;
            /* Убираем объёмный эффект для игроков */
            text-shadow: none;
        }

        .player-bet {
            font-size: 0.85rem;
            color: white;
            display: flex;
            align-items: center;
            gap: 4px;
            white-space: nowrap;
            min-width: 80px;
            justify-content: center;
            /* Убираем объёмный эффект для игроков */
            text-shadow: none;
        }

        .player-cashout {
            font-size: 0.85rem;
            color: #1cbf19;
            display: flex;
            align-items: center;
            gap: 4px;
            font-weight: 700;
            white-space: nowrap;
            min-width: 90px;
            justify-content: flex-end;
            /* Убираем объёмный эффект для игроков */
            text-shadow: none;
        }

        .player-lost {
            font-size: 0.85rem;
            color: #ff4444;
            font-weight: 700;
            /* Убираем объёмный эффект для игроков */
            text-shadow: none;
        }

        .player-bet-info {
            display: flex;
            align-items: center;
            gap: 15px;
            flex: 1;
            justify-content: space-between;
            min-width: 0;
        }

        .current-win-amount {
            font-size: 0.8rem;
            color: #1cbf19;
            font-weight: 700;
            margin-top: 5px;
            /* Убираем объёмный эффект для игроков */
            text-shadow: none;
        }

        /* Текст о ставке внизу экрана */
        .bet-info-display {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.5);
            z-index: 100;
            text-align: center;
            pointer-events: none;
            text-transform: none;
        }

        .game-area {
            position: relative;
            overflow: visible;
        }

        .game-canvas {
            background: rgba(30, 30, 30, 0.9);
            border-radius: 35px;
            border: 3px solid #00aaff;
            position: relative;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            height: 720px;
            width: 100%;
            background-image: 
                linear-gradient(rgba(0, 170, 255, 0.1) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 170, 255, 0.1) 1px, transparent 1px);
            background-size: 20px 20px;
        }

        .game-canvas::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 20% 80%, rgba(0, 170, 255, 0.05) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(102, 204, 255, 0.05) 0%, transparent 50%);
            animation: backgroundPulse 4s ease-in-out infinite alternate;
        }

        .game-canvas.heartbeat::before {
            animation: heartbeatPulse 0.8s ease-in-out;
        }

        @keyframes backgroundPulse {
            0% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        @keyframes heartbeatPulse {
            0% { 
                opacity: 0.5; 
                transform: scale(1);
            }
            25% { 
                opacity: 0.8; 
                transform: scale(1.02);
            }
            50% { 
                opacity: 1; 
                transform: scale(1.05);
            }
            75% { 
                opacity: 0.8; 
                transform: scale(1.02);
            }
            100% { 
                opacity: 0.5; 
                transform: scale(1);
            }
        }

        .multiplier-display {
            position: absolute;
            top: 50px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 4rem;
            font-weight: 900;
            color: white;
            z-index: 10;
            transition: all 0.1s ease;
        }

        .multiplier-display.red {
            color: #ff4444;
        }

        .win-display {
            position: absolute;
            top: 120px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 2.5rem;
            font-weight: 900;
            color: #ffaa00;
            z-index: 11;
            opacity: 0;
            transition: all 0.3s ease;
        }

        .win-display.show {
            opacity: 1;
            animation: winPulse 2s ease-in-out;
        }

        @keyframes winPulse {
            0% { transform: translateX(-50%) scale(0.8); opacity: 0; }
            20% { transform: translateX(-50%) scale(1.2); opacity: 1; }
            80% { transform: translateX(-50%) scale(1); opacity: 1; }
            100% { transform: translateX(-50%) scale(1); opacity: 0; }
        }

        /* Кнопка ПОСТАВИТЬ увеличена в 1.25 раза */
        .game-action-button {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%) scale(1.25);
            padding: 15px 30px;
            border: none;
            border-radius: 25px;
            font-family: 'Orbitron', monospace;
            font-size: 1.2rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 25;
            text-transform: none;
            width: auto;
            max-width: 250px;
            /* Убираем объёмный эффект для кнопки ПОСТАВИТЬ */
            text-shadow: none;
        }

        .game-action-button.bet {
            background: linear-gradient(45deg, #007acc, #0099ff);
            color: white;
            box-shadow: 0 5px 15px rgba(0, 153, 255, 0.4);
        }

        .game-action-button.cashout {
            background: linear-gradient(45deg, #00aaff, #00ddff);
            color: white;
            box-shadow: 0 5px 15px rgba(0, 170, 255, 0.4);
        }

        .game-action-button.cancel {
            background: linear-gradient(45deg, #ff4444, #ff6666);
            color: white;
            box-shadow: 0 5px 15px rgba(255, 68, 68, 0.4);
        }

        .game-action-button.login {
            background: #c72626;
            color: white;
            box-shadow: 0 5px 15px rgba(199, 38, 38, 0.4);
            letter-spacing: 1px;
        }

        .game-action-button:hover {
            transform: translateX(-50%) scale(1.25) translateY(-3px);
        }

        .trading-chart {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 5;
        }

        .chart-line {
            stroke: #00aaff;
            stroke-width: 4;
            fill: none;
            filter: drop-shadow(0 0 10px #00aaff);
            transition: stroke 0.3s ease;
        }

        .chart-line.crashed {
            stroke: #ff4444;
            filter: drop-shadow(0 0 10px #ff4444);
        }

        .chart-area {
            fill: url(#gradient);
            opacity: 0.3;
        }

        .game-gif {
            position: absolute;
            width: 120px;
            height: 120px;
            z-index: 8;
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
            border-radius: 15px;
        }

        .game-gif.show {
            opacity: 1;
        }

        .countdown-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 20;
            border-radius: 35px;
        }

        .countdown-number {
            font-size: 8rem;
            font-weight: 900;
            color: #00aaff;
            animation: heartbeat 1s ease-in-out;
        }

        @keyframes heartbeat {
            0% { transform: scale(0.8); opacity: 0.5; }
            50% { transform: scale(1.2); opacity: 1; }
            100% { transform: scale(1); opacity: 1; }
        }

        .game-crashed {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 3rem;
            color: #ff0044;
            font-weight: 900;
            z-index: 15;
            animation: crashPulse 0.5s ease-in-out;
            text-transform: none;
        }

        @keyframes crashPulse {
            0% { transform: translate(-50%, -50%) scale(0); }
            50% { transform: translate(-50%, -50%) scale(1.2); }
            100% { transform: translate(-50%, -50%) scale(1); }
        }

        .betting-panel {
            background: rgba(30, 30, 30, 0.9);
            border-radius: 25px;
            border: 2px solid #00aaff;
            padding: 30px;
            backdrop-filter: blur(10px);
        }

        .game-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: rgba(30, 30, 30, 0.9);
            padding: 20px;
            border-radius: 20px;
            border: 2px solid #00aaff;
            text-align: center;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 900;
            color: white;
        }

        .stat-label {
            margin-top: 5px;
            font-size: 0.9rem;
            color: white;
            opacity: 0.8;
            text-transform: none;
        }

        .history-panel {
            background: rgba(30, 30, 30, 0.9);
            border-radius: 20px;
            border: 2px solid #00aaff;
            padding: 20px;
        }

        .history-title {
            font-weight: 700;
            margin-bottom: 15px;
            color: white;
            text-transform: none;
        }

        .history-list {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .history-item {
            padding: 8px 15px;
            border-radius: 25px;
            font-weight: 700;
            font-size: 0.9rem;
        }

        .history-item.win {
            background: rgba(0, 170, 255, 0.3);
            color: white;
        }

        .history-item.lose {
            background: rgba(255, 68, 68, 0.3);
            color: white;
        }

        .game-history-mini {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
            z-index: 15;
        }

        .mini-result {
            width: 60px;
            height: 40px;
            border-radius: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 900;
            font-size: 0.9rem;
            border: 2px solid;
            animation: slideIn 0.5s ease-out;
        }

        .mini-result.red {
            background: rgba(255, 68, 68, 0.3);
            color: #ff4444;
            border-color: #ff4444;
        }

        .mini-result.orange {
            background: rgba(255, 165, 0, 0.3);
            color: #ffa500;
            border-color: #ffa500;
        }

        .mini-result.white {
            background: rgba(255, 255, 255, 0.3);
            color: #ffffff;
            border-color: #ffffff;
        }

        .mini-result.pending {
            background: rgba(102, 204, 255, 0.3);
            color: #66ccff;
            border-color: #66ccff;
            animation: pulse 1s infinite;
        }

        @keyframes slideIn {
            0% { transform: translateX(100px); opacity: 0; }
            100% { transform: translateX(0); opacity: 1; }
        }

        @keyframes pulse {
            0% { opacity: 0.5; }
            50% { opacity: 1; }
            100% { opacity: 0.5; }
        }

        /* Кнопка техподдержки в правом нижнем углу */
        .support-button {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #007acc;
            color: white;
            border: none;
            border-radius: 20px;
            padding: 10px 20px;
            font-family: 'Orbitron', monospace;
            font-weight: 700;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 1000;
            text-transform: none;
        }

        .support-button:hover {
            background: #005a99;
            transform: translateY(-2px);
        }

        /* Модальные окна */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .modal-overlay.show {
            opacity: 1;
            visibility: visible;
        }

        .modal {
            background: rgba(30, 30, 30, 0.95);
            border: 3px solid #00aaff;
            border-radius: 35px;
            padding: 40px;
            max-width: 500px;
            width: 90%;
            text-align: center;
            backdrop-filter: blur(15px);
            transform: scale(0.8);
            transition: transform 0.3s ease;
        }

        .modal-overlay.show .modal {
            transform: scale(1);
        }

        .modal h2 {
            color: white;
            margin-bottom: 30px;
            font-size: 2rem;
            text-transform: none;
        }

        .modal-input {
            width: 100%;
            padding: 20px;
            background: rgba(0, 0, 0, 0.7);
            border: 2px solid #00aaff;
            border-radius: 20px;
            color: white;
            font-family: 'Orbitron', monospace;
            font-size: 1.5rem;
            font-weight: 700;
            text-align: center;
            margin-bottom: 30px;
        }

        .modal-input:focus {
            outline: none;
            box-shadow: 0 0 20px rgba(0, 170, 255, 0.5);
        }

        .modal-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
        }

        .modal-btn {
            padding: 15px 30px;
            border: none;
            border-radius: 20px;
            font-family: 'Orbitron', monospace;
            font-weight: 900;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: none;
        }

        .modal-btn.confirm {
            background: #56bd46;
            color: #fff;
        }

        .modal-btn.cancel {
            background: linear-gradient(45deg, #ff4444, #ff6666);
            color: white;
        }

        .modal-btn:hover {
            transform: translateY(-2px);
        }

        .deposit-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .deposit-btn {
            padding: 20px;
            background: rgba(0, 170, 255, 0.2);
            border: 2px solid #00aaff;
            border-radius: 20px;
            color: white;
            cursor: pointer;
            font-family: 'Orbitron', monospace;
            font-weight: 700;
            font-size: 1.1rem;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            text-transform: none;
        }

        .deposit-btn:hover {
            background: rgba(0, 170, 255, 0.4);
            transform: translateY(-2px);
        }

        .cryptopay-btn {
            background: #0e6bad;
            color: white;
            border: 2px solid #0e6bad;
            padding: 15px 25px;
            border-radius: 20px;
            font-family: 'Orbitron', monospace;
            font-weight: 700;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 20px;
            text-transform: none;
        }

        .cryptopay-btn:hover {
            background: #0a547a;
            transform: translateY(-2px);
        }

        .ton-logo-rounded {
            border-radius: 50%;
        }

        .qr-container {
            text-align: center;
            margin-bottom: 20px;
        }

        .qr-image {
            max-width: 200px;
            margin-bottom: 15px;
        }

        .copy-text {
            background: rgba(0, 0, 0, 0.5);
            padding: 15px;
            border-radius: 15px;
            font-family: monospace;
            font-size: 12px;
            word-break: break-all;
            margin-bottom: 10px;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .copy-text:hover {
            background: rgba(0, 0, 0, 0.7);
        }

        .timer-display {
            font-size: 1.5rem;
            color: #ff4444;
            font-weight: 900;
            margin-bottom: 20px;
        }

        .deposit-status {
            text-align: center;
            padding: 20px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            margin-bottom: 20px;
        }

        .account-modal {
            max-width: 600px;
        }

        .account-info {
            background: rgba(0, 0, 0, 0.5);
            padding: 20px;
            border-radius: 20px;
            margin-bottom: 30px;
        }

        .account-balance {
            font-size: 2.5rem;
            color: white;
            font-weight: 900;
            margin-bottom: 20px;
        }

        .account-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 30px;
        }

        .last-bets {
            text-align: left;
        }

        .last-bets h3 {
            color: white;
            margin-bottom: 15px;
            text-transform: none;
        }

        .bet-item {
            background: rgba(0, 170, 255, 0.1);
            padding: 12px;
            border-radius: 15px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: white;
        }

        .bet-result.win {
            color: #1cbf19;
        }

        .bet-result.lose {
            color: #ff4444;
        }

        /* Модальное окно ставки */
        .bet-modal {
            background: rgba(30, 30, 30, 0.98);
            border: 3px solid #00aaff;
            border-radius: 35px;
            padding: 40px;
            max-width: 400px;
            width: 90%;
            text-align: center;
            backdrop-filter: blur(20px);
            transform: scale(0.8);
            transition: transform 0.3s ease;
        }

        .bet-modal-overlay.show .bet-modal {
            transform: scale(1);
        }

        .bet-amount-input {
            width: 100%;
            padding: 20px;
            background: rgba(0, 0, 0, 0.7);
            border: 2px solid #00aaff;
            border-radius: 20px;
            color: white;
            font-family: 'Orbitron', monospace;
            font-size: 1.8rem;
            font-weight: 700;
            text-align: center;
            margin-bottom: 20px;
        }

        .bet-amount-input:focus {
            outline: none;
            box-shadow: 0 0 20px rgba(0, 170, 255, 0.5);
        }

        .quick-bet-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .quick-bet {
            padding: 15px;
            background: rgba(0, 170, 255, 0.2);
            border: 2px solid #00aaff;
            border-radius: 15px;
            color: white;
            cursor: pointer;
            font-family: 'Orbitron', monospace;
            font-weight: 700;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
        }

        .quick-bet:hover {
            background: rgba(0, 170, 255, 0.4);
        }

        .auto-cashout-group {
            margin-bottom: 20px;
        }

        .auto-cashout-group label {
            display: block;
            color: white;
            margin-bottom: 10px;
            font-size: 0.9rem;
            text-transform: none;
        }

        .auto-cashout-input {
            width: 100%;
            padding: 15px;
            background: rgba(0, 0, 0, 0.7);
            border: 2px solid #00aaff;
            border-radius: 15px;
            color: white;
            font-family: 'Orbitron', monospace;
            font-size: 1.2rem;
            font-weight: 700;
            text-align: center;
        }

        .auto-cashout-input:focus {
            outline: none;
            box-shadow: 0 0 20px rgba(0, 170, 255, 0.5);
        }

        /* Модальное окно выигрыша */
        .win-modal {
            background: rgba(30, 30, 30, 0.98);
            border: 3px solid #ffaa00;
            border-radius: 35px;
            padding: 50px;
            max-width: 450px;
            width: 90%;
            text-align: center;
            backdrop-filter: blur(20px);
            transform: scale(0.8);
            transition: transform 0.3s ease;
            position: relative;
        }

        /* Полупрозрачное серое окно с картинкой при выигрыше */
        .win-modal::before {
            content: '';
            position: absolute;
            top: -80px;
            left: 50%;
            transform: translateX(-50%);
            width: 120px;
            height: 120px;
            background: rgba(128, 128, 128, 0.7);
            border-radius: 15px;
            background-image: url('https://podarki-tg.com/wp-content/uploads/2025/06/image-520.png');
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            backdrop-filter: blur(10px);
            z-index: -1;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        .win-modal-overlay.show .win-modal {
            transform: scale(1);
        }

        .win-modal h2 {
            color: white;
            margin-bottom: 30px;
            font-size: 2.5rem;
            text-transform: none;
        }

        .win-modal .modal-btn {
            color: white;
        }

        .win-modal .win-multiplier {
            color: white;
        }

        .win-amount {
            font-size: 4rem;
            font-weight: 900;
            color: #ffaa00;
            margin-bottom: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .win-multiplier {
            font-size: 1.5rem;
            color: white;
            margin-bottom: 30px;
            text-transform: none;
        }

        /* Модальное окно вывода */
        .withdraw-modal {
            background: rgba(30, 30, 30, 0.98);
            border: 3px solid #ff6b6b;
            border-radius: 35px;
            padding: 40px;
            max-width: 500px;
            width: 90%;
            text-align: center;
            backdrop-filter: blur(20px);
            transform: scale(0.8);
            transition: transform 0.3s ease;
        }

        .withdraw-modal-overlay.show .withdraw-modal {
            transform: scale(1);
        }

        .withdraw-input {
            width: 100%;
            padding: 20px;
            background: rgba(0, 0, 0, 0.7);
            border: 2px solid #ff6b6b;
            border-radius: 20px;
            color: white;
            font-family: 'Orbitron', monospace;
            font-size: 1.5rem;
            font-weight: 700;
            text-align: center;
            margin-bottom: 20px;
        }

        .withdraw-input:focus {
            outline: none;
            box-shadow: 0 0 20px rgba(255, 107, 107, 0.5);
        }

        .withdraw-info {
            background: rgba(255, 107, 107, 0.1);
            padding: 15px;
            border-radius: 15px;
            margin-bottom: 20px;
            color: white;
            font-size: 0.9rem;
            text-transform: none;
        }

        /* Кнопка смены языка */
        .language-switcher {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: rgba(30, 30, 30, 0.9);
            border: 2px solid #00aaff;
            border-radius: 20px;
            color: white;
            font-family: 'Orbitron', monospace;
            font-weight: 700;
            padding: 10px 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            z-index: 1001;
        }

        .language-switcher:hover {
            background: rgba(0, 170, 255, 0.2);
            transform: translateY(-2px);
        }

        /* Модальное окно выбора цвета баланса */
        .color-picker-modal {
            background: rgba(30, 30, 30, 0.98);
            border: 3px solid #00aaff;
            border-radius: 35px;
            padding: 40px;
            max-width: 400px;
            width: 90%;
            text-align: center;
            backdrop-filter: blur(20px);
            transform: scale(0.8);
            transition: transform 0.3s ease;
        }

        .color-picker-modal-overlay.show .color-picker-modal {
            transform: scale(1);
        }

        .color-picker {
            width: 100%;
            height: 60px;
            border: 2px solid #00aaff;
            border-radius: 15px;
            margin-bottom: 20px;
            cursor: pointer;
        }

        .color-preview {
            width: 100%;
            height: 40px;
            background: white;
            border-radius: 15px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 900;
            color: black;
        }

        /* Модальное окно поддержки */
        .support-modal {
            background: rgba(30, 30, 30, 0.98);
            border: 3px solid #007acc;
            border-radius: 35px;
            padding: 40px;
            max-width: 500px;
            width: 90%;
            text-align: left;
            backdrop-filter: blur(20px);
            transform: scale(0.8);
            transition: transform 0.3s ease;
        }

        .support-modal-overlay.show .support-modal {
            transform: scale(1);
        }

        .support-chat {
            height: 300px;
            overflow-y: auto;
            border: 2px solid #007acc;
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 20px;
            background: rgba(0, 0, 0, 0.5);
        }

        .chat-message {
            margin-bottom: 15px;
            padding: 10px;
            border-radius: 10px;
        }

        .chat-message.user {
            background: rgba(0, 122, 204, 0.3);
            text-align: right;
        }

        .chat-message.bot {
            background: rgba(128, 128, 128, 0.3);
        }

        .support-input-container {
            display: flex;
            gap: 10px;
        }

        .support-input {
            flex: 1;
            padding: 10px;
            background: rgba(0, 0, 0, 0.7);
            border: 2px solid #007acc;
            border-radius: 10px;
            color: white;
            font-family: 'Orbitron', monospace;
        }

        .support-send {
            background: #007acc;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 10px;
            cursor: pointer;
            font-family: 'Orbitron', monospace;
            font-weight: 700;
            text-transform: none;
        }

        /* Модальное окно PEPE при входе на сайт */
        .pepe-welcome-modal {
            background: rgba(30, 30, 30, 0.98);
            border: 3px solid #00aaff;
            border-radius: 35px;
            padding: 40px;
            max-width: 500px;
            width: 90%;
            text-align: center;
            backdrop-filter: blur(20px);
            transform: scale(0.8);
            transition: transform 0.3s ease;
        }

        .pepe-welcome-modal-overlay.show .pepe-welcome-modal {
            transform: scale(1);
        }

        .pepe-welcome-image {
            width: 150px;
            height: 150px;
            border-radius: 15px;
            object-fit: cover;
            margin: 0 auto 20px;
        }

        .pepe-welcome-title {
            font-size: 2.5rem;
            font-weight: 900;
            color: white;
            margin-bottom: 20px;
            text-transform: none;
            /* Объёмный шрифт как у PEPE */
            text-shadow: 3px 3px 6px rgba(0, 0, 0, 0.9), 0 0 15px rgba(255, 255, 255, 0.2);
        }

        .pepe-welcome-description {
            font-size: 1.2rem;
            color: white;
            margin-bottom: 30px;
            text-transform: none;
        }

        .pulse-animation {
            animation: pulseBalance 0.5s ease-in-out;
        }

        @keyframes pulseBalance {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .counting-animation {
            animation: countUp 2s ease-out;
        }

        @keyframes countUp {
            0% { transform: scale(0.8); opacity: 0.5; }
            50% { transform: scale(1.1); opacity: 0.8; }
            100% { transform: scale(1); opacity: 1; }
        }

        @media (max-width: 1400px) {
            .main-content {
                grid-template-columns: 1fr;
                height: auto;
            }
            
            .game-canvas {
                height: 480px;
            }

            .players-panel {
                order: 2;
                max-height: 400px;
            }

            .betting-panel {
                order: 3;
            }

            .online-panel {
                position: relative;
                width: 100%;
                height: auto;
                transform: none;
                margin-bottom: 20px;
            }

            .header-center {
                position: static;
                transform: none;
            }
        }

        @media (max-width: 768px) {
            body {
                padding: 10px;
            }

            .header {
                flex-direction: column;
                gap: 20px;
                text-align: center;
                padding: 15px;
            }

            .header-center {
                position: static;
                transform: none;
                width: 100%;
                justify-content: center;
                flex-wrap: wrap;
            }

            .nav-button {
                padding: 12px 20px;
                font-size: 0.9rem;
                min-width: 80px;
            }

            .balance-container {
                flex-direction: column;
                text-align: center;
                padding: 15px;
            }

            .balance-buttons {
                justify-content: center;
                flex-wrap: wrap;
                gap: 8px;
                margin-top: 15px;
            }

            .balance-button, .menu-button {
                padding: 6px 12px;
                font-size: 0.8rem;
            }

            .game-canvas {
                height: 400px;
                margin-bottom: 20px;
            }

            .multiplier-display {
                font-size: 3rem;
            }

            .win-display {
                font-size: 2rem;
            }

            .game-action-button {
                font-size: 1.1rem;
                padding: 15px 30px;
            }

            .bonus-content, .wallet-content {
                padding: 15px;
                max-width: 100%;
            }

            .bonus-title, .wallet-title {
                font-size: 2rem;
            }

            .bonus-stages {
                grid-template-columns: repeat(2, 1fr);
                gap: 15px;
            }

            .bonus-stats {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .wallet-buttons {
                flex-direction: column;
                gap: 15px;
            }

            .wallet-balance-main {
                font-size: 2.5rem;
            }

            .crypto-item {
                padding: 15px;
            }

            .crypto-icon {
                width: 35px;
                height: 35px;
            }

            .modal {
                padding: 20px;
                max-width: 95%;
            }

            .modal h2 {
                font-size: 1.5rem;
                margin-bottom: 20px;
            }

            .modal-input {
                font-size: 1.2rem;
                padding: 15px;
            }

            .bet-modal {
                max-width: 95%;
                padding: 20px;
            }

            .quick-bet-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .win-modal {
                max-width: 95%;
                padding: 30px;
            }

            .win-amount {
                font-size: 3rem;
            }

            .players-panel {
                max-height: 300px;
            }

            .player-item {
                padding: 8px 12px;
                font-size: 0.8rem;
            }

            .pepe-contest {
                flex-direction: column;
                text-align: center;
            }

            .pepe-contest-image {
                width: 100px;
                height: 100px;
                margin: 0 auto 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo">
                <img src="https://i.postimg.cc/1XymT8ft/sdfv.png" alt="TON CRASH">
            </div>
            
            <!-- Кнопки навигации в центре header -->
            <div class="header-center">
                <button class="nav-button active" id="crashBtn" onclick="switchToSlide(0)" data-lang="crash-game">Crash</button>
                <button class="nav-button" id="bonusBtn" onclick="switchToSlide(1)" data-lang="bonus">Бонусы</button>
                <button class="nav-button" id="walletBtn" onclick="switchToSlide(2)" data-lang="wallet">Кошелек</button>
            </div>
            
            <div class="balance-container">
                <div class="balance-logo">
                    <img src="https://files.svgcdn.io/token-branded/ton.png" alt="TON" class="ton-icon">
                </div>
                <div>
                    <div style="font-size: 0.9rem; opacity: 0.8;" data-lang="balance">Баланс</div>
                    <div class="balance-amount" id="balance" onclick="showColorPicker()">
                        <span id="balanceText" class="balance-blurred">1000.00</span>
                        <img src="https://files.svgcdn.io/token-branded/ton.png" alt="" class="ton-icon">
                    </div>
                    <div class="balance-buttons" id="balanceButtons" style="display: none;">
                        <button class="balance-button deposit" onclick="showDepositModal()" data-lang="deposit">Пополнить</button>
                        <div style="position: relative;">
                            <button class="menu-button" onclick="toggleMenu()" id="menuButton">⋯</button>
                            <div class="dropdown-menu" id="dropdownMenu">
                                <button class="dropdown-item" onclick="showWithdrawModal(); toggleMenu()" data-lang="withdraw">Вывод средств</button>
                                <button class="dropdown-item" onclick="switchToSlide(2); toggleMenu()">Кошелек</button>
                                <button class="dropdown-item" onclick="showAccountModal(); toggleMenu()">Профиль</button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="login-overlay" id="loginOverlay">
                    <button class="login-btn" onclick="showLoginModal()" data-lang="login">Войти</button>
                </div>
            </div>
        </div>

        <!-- Кнопка техподдержки в правом нижнем углу -->
        <button class="support-button" onclick="showSupportModal()">Тех. поддержка</button>

        <div class="content-slider">
            <div class="slider-container" id="sliderContainer">
                <!-- Слайд с игрой -->
                <div class="slide">
                    <div class="main-content">
                        <div class="online-panel">
                            <div class="online-indicator">
                                <div class="online-dot"></div>
                                <span class="online-text" data-lang="online">Онлайн</span>
                            </div>
                            <div class="online-count" id="onlineCount">127</div>
                        </div>

                        <div class="players-panel">
                            <!-- Кнопка отмены ставки в панели игроков -->
                            <button class="cancel-bet-button" id="cancelBetButton" onclick="cancelBet()" data-lang="cancel-bet">Отменить ставку</button>
                            <div class="players-title" data-lang="players-online">Игроки</div>
                            <div id="playersList"></div>
                        </div>

                        <div class="game-area">
                            <div class="game-canvas" id="gameCanvas">
                                <div class="multiplier-display" id="multiplier">1.00x</div>
                                <div class="win-display" id="winDisplay">+0.00</div>
                                
                                <svg class="trading-chart" id="tradingChart" viewBox="0 0 800 500">
                                    <defs>
                                        <linearGradient id="gradient" x1="0%" y1="0%" x2="0%" y2="100%">
                                            <stop offset="0%" style="stop-color:#00aaff;stop-opacity:0.8" />
                                            <stop offset="100%" style="stop-color:#00aaff;stop-opacity:0" />
                                        </linearGradient>
                                    </defs>
                                    <path class="chart-area" id="chartArea" d=""></path>
                                    <path class="chart-line" id="chartLine" d=""></path>
                                </svg>
                                
                                <img src="" alt="Game Animation" class="game-gif" id="gameGif">
                                <div class="game-history-mini" id="gameHistoryMini"></div>
                                <div class="countdown-overlay" id="countdown" style="display: none;">
                                    <div class="countdown-number" id="countdownNumber">3</div>
                                </div>

                                <!-- Кнопка действия в игре -->
                                <button class="game-action-button login" id="gameActionButton" onclick="showLoginModal()" data-lang="login">Войти</button>
                            </div>
                        </div>

                        <div class="betting-panel">
                            <div class="game-stats">
                                <div class="stat-card">
                                    <div class="stat-value" id="totalGames">0</div>
                                    <div class="stat-label" data-lang="total-games">Всего игр</div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-value" id="winRate">0%</div>
                                    <div class="stat-label" data-lang="win-rate">Процент побед</div>
                                </div>
                            </div>

                            <div class="history-panel">
                                <div class="history-title" data-lang="game-history">История последних игр</div>
                                <div class="history-list" id="historyList"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Слайд с бонусами -->
                <div class="slide">
                    <div class="bonus-content">
                        <div class="bonus-title" data-lang="bonus-system">Бонусная система</div>
                        
                        <div class="bonus-info">
                            <div class="bonus-progress">
                                <div class="bonus-progress-text" id="bonusProgressText" data-lang="stage-progress">Стадия 1 из 5</div>
                                <div class="bonus-progress-bar">
                                    <div class="bonus-progress-fill" id="bonusProgressFill" style="width: 0%"></div>
                                </div>
                            </div>
                            
                            <div class="bonus-stats">
                                <div class="bonus-stat">
                                    <div class="bonus-stat-value" id="totalDeposits">0</div>
                                    <div class="bonus-stat-label" data-lang="total-deposits">Всего пополнений</div>
                                </div>
                                <div class="bonus-stat">
                                    <div class="bonus-stat-value" id="totalBonus">0.00</div>
                                    <div class="bonus-stat-label" data-lang="bonus-received">Получено бонусов</div>
                                </div>
                                <div class="bonus-stat">
                                    <div class="bonus-stat-value" id="nextBonusAmount">100%</div>
                                    <div class="bonus-stat-label" data-lang="next-bonus">Следующий бонус</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bonus-stages" id="bonusStages">
                            <!-- Стадии бонусов будут добавлены через JavaScript -->
                        </div>
                        
                        <!-- Новый блок конкурса PEPE -->
                        <div class="pepe-contest">
                            <img src="https://i.postimg.cc/hGpYHrm4/rounded-in-photoretrica-10.png" alt="PEPE Contest" class="pepe-contest-image">
                            <div class="pepe-contest-content">
                                <div class="pepe-contest-title">Выиграйте PEPE</div>
                                <button class="pepe-contest-button" onclick="participateInContest()">Участвовать</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Слайд с кошельком -->
                <div class="slide">
                    <div class="wallet-content">
                        <div class="wallet-title" data-lang="wallet-title">Мой кошелек</div>
                        
                        <div class="wallet-balance">
                            <div class="wallet-balance-main" id="walletBalanceMain">1000.00 TON</div>
                            <div class="wallet-balance-usd" id="walletBalanceUSD">~ $2,500.00</div>
                        </div>
                        
                        <div class="wallet-buttons">
                            <button class="wallet-button deposit" onclick="showDepositModal()" data-lang="deposit">Пополнить</button>
                            <button class="wallet-button withdraw" onclick="showWithdrawModal()" data-lang="withdraw">Вывести</button>
                        </div>
                        
                        <div class="crypto-list">
                            <div class="crypto-item">
                                <div class="crypto-info">
                                    <div class="crypto-icon" style="background: linear-gradient(45deg, #0098ea, #00a6fb);">
                                        <img src="https://ton.org/download/ton_symbol.png" alt="TON">
                                    </div>
                                    <div class="crypto-name">TON</div>
                                </div>
                                <div class="crypto-balance">
                                    <div class="crypto-amount" id="tonBalance">1000.00 TON</div>
                                    <div class="crypto-usd" id="tonUSD">≈ $2,500.00</div>
                                </div>
                            </div>
                            
                            <div class="crypto-item">
                                <div class="crypto-info">
                                    <div class="crypto-icon" style="background: linear-gradient(45deg, #26a17b, #2db187);">
                                        <img src="https://upload.wikimedia.org/wikipedia/commons/0/01/USDT_Logo.png" alt="USDT">
                                    </div>
                                    <div class="crypto-name">USDT</div>
                                </div>
                                <div class="crypto-balance">
                                    <div class="crypto-amount" id="usdtBalance">2500.00 USDT</div>
                                    <div class="crypto-usd" id="usdtUSD">≈ $2,500.00</div>
                                </div>
                            </div>
                            
                            <div class="crypto-item">
                                <div class="crypto-info">
                                    <div class="crypto-icon" style="background: linear-gradient(45deg, #f7931a, #ffb347);">
                                        <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/4/46/Bitcoin.svg/2048px-Bitcoin.svg.png" alt="Bitcoin" style="width: 25px; height: 25px;">
                                    </div>
                                    <div class="crypto-name">BITCOIN</div>
                                </div>
                                <div class="crypto-balance">
                                    <div class="crypto-amount" id="btcBalance">0.02589 BTC</div>
                                    <div class="crypto-usd" id="btcUSD">≈ $2,500.00</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Кнопка смены языка -->
    <button class="language-switcher" onclick="toggleLanguage()" id="languageSwitcher">RU</button>

    <!-- Текст о ставке -->
    <div class="bet-info-display" id="betInfoDisplay" style="display: none;"></div>

    <!-- Модальное окно приветствия PEPE -->
    <div class="modal-overlay pepe-welcome-modal-overlay" id="pepeWelcomeModal">
        <div class="modal pepe-welcome-modal">
            <img src="https://i.postimg.cc/hGpYHrm4/rounded-in-photoretrica-10.png" alt="PEPE Contest" class="pepe-welcome-image">
            <div class="pepe-welcome-title">Выиграйте PEPE!</div>
            <div class="pepe-welcome-description">
                Примите участие в конкурсе и получите шанс выиграть PEPE токены!
            </div>
            <div class="modal-buttons">
                <button class="modal-btn confirm" onclick="participateInContest(); closePepeWelcomeModal()">Участвовать</button>
                <button class="modal-btn cancel" onclick="closePepeWelcomeModal()">Позже</button>
            </div>
        </div>
    </div>

    <!-- Модальное окно входа -->
    <div class="modal-overlay" id="loginModal">
        <div class="modal">
            <h2 data-lang="login-title">Вход в игру</h2>
            <input type="text" class="modal-input" id="telegramNick" data-lang-placeholder="enter-nickname" placeholder="Введите ваш ник в Telegram" maxlength="20">
            <div class="modal-buttons">
                <button class="modal-btn confirm" onclick="login()" data-lang="login">Войти</button>
                <button class="modal-btn cancel" onclick="closeLoginModal()" data-lang="cancel">Отмена</button>
            </div>
        </div>
    </div>

    <!-- Модальное окно ставки -->
    <div class="modal-overlay bet-modal-overlay" id="betModal">
        <div class="modal bet-modal">
            <h2 data-lang="place-bet">Сделать ставку</h2>
            <input type="number" class="bet-amount-input" id="betAmountInput" placeholder="0.10" min="0.01" step="0.01">
            
            <div class="quick-bet-grid">
                <button class="quick-bet" onclick="setBetAmountModal(0.1)">
                    0.1 <img src="https://files.svgcdn.io/token-branded/ton.png" alt="TON" style="width: 16px; height: 16px;">
                </button>
                <button class="quick-bet" onclick="setBetAmountModal(0.5)">
                    0.5 <img src="https://files.svgcdn.io/token-branded/ton.png" alt="TON" style="width: 16px; height: 16px;">
                </button>
                <button class="quick-bet" onclick="setBetAmountModal(1.0)">
                    1.0 <img src="https://files.svgcdn.io/token-branded/ton.png" alt="TON" style="width: 16px; height: 16px;">
                </button>
                <button class="quick-bet" onclick="setBetAmountModal(5.0)">
                    5.0 <img src="https://files.svgcdn.io/token-branded/ton.png" alt="TON" style="width: 16px; height: 16px;">
                </button>
                <button class="quick-bet" onclick="setBetAmountModal(10.0)">
                    10.0 <img src="https://files.svgcdn.io/token-branded/ton.png" alt="TON" style="width: 16px; height: 16px;">
                </button>
                <button class="quick-bet" onclick="doubleBetModal()">2x</button>
            </div>

            <div class="auto-cashout-group">
                <label for="autoCashoutInput" data-lang="auto-cashout">Авто-кэшаут при (0 = выключен)</label>
                <input type="number" id="autoCashoutInput" class="auto-cashout-input" value="0" min="0" step="0.01" placeholder="0">
            </div>

            <div class="modal-buttons">
                <button class="modal-btn confirm" onclick="confirmBet()" data-lang="place-bet">Поставить</button>
                <button class="modal-btn cancel" onclick="closeBetModal()" data-lang="cancel">Отмена</button>
            </div>
        </div>
    </div>

    <!-- Модальное окно пополнения -->
    <div class="modal-overlay" id="depositModal">
        <div class="modal">
            <h2 data-lang="deposit-balance">Пополнение баланса</h2>
            
            <button class="cryptopay-btn" onclick="openCryptoPay()">
                CryptoPay [+2%]
            </button>
            
            <div class="deposit-buttons">
                <button class="deposit-btn" onclick="depositCurrency('TON')" id="tonDepositBtn">
                    <img src="https://i.postimg.cc/Vk7BwHKh/image-1.png" alt="TON" class="ton-logo-rounded" style="width: 24px; height: 24px;">
                    TON
                </button>
                <button class="deposit-btn" onclick="depositCurrency('SBP')" id="sbpDepositBtn">
                    <img src="https://png.klev.club/uploads/posts/2024-05/png-klev-club-92ub-p-sbp-logotip-png-18.png" alt="СБП" style="width: 30px; height: 30px; object-fit: contain;">
                    СБП
                </button>
            </div>
            <input type="number" class="modal-input" id="depositAmount" data-lang-placeholder="enter-deposit-amount" placeholder="Введите сумму для пополнения" min="1" step="1">
            <div class="modal-buttons" id="depositButtons">
                <button class="modal-btn confirm" onclick="confirmDeposit()" data-lang="deposit">Пополнить</button>
                <button class="modal-btn cancel" onclick="closeDepositModal()" data-lang="cancel">Отмена</button>
            </div>

            <!-- Контейнер для QR кода и информации о пополнении TON -->
            <div id="tonDepositInfo" style="display: none;">
                <div class="qr-container">
                    <img src="https://i.postimg.cc/XYg1C8QK/5375564163138584120.jpg" alt="QR Code" class="qr-image">
                    <div class="copy-text" onclick="copyAddress()">
                        UQCvyMHj2r7Ig73EcbBI3h405uemns12eX49OBW3cVsOEzuW
                    </div>
                    <div class="timer-display" id="timerDisplay">05:00</div>
                    <div class="deposit-status">
                        <p>Ожидание платежа...</p>
                        <p>Средства будут зачислены автоматически после истечения таймера</p>
                    </div>
                </div>
                <div class="modal-buttons">
                    <button class="modal-btn cancel" onclick="closeDepositModal()">Закрыть</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Модальное окно вывода -->
    <div class="modal-overlay" id="withdrawModal">
        <div class="modal withdraw-modal">
            <h2 data-lang="withdraw-balance">Вывод средств</h2>
            <div class="withdraw-info">
                <p data-lang="withdraw-info">Минимальная сумма для вывода: 1 TON</p>
                <p data-lang="withdraw-fee">Комиссия сети: 0.02 TON</p>
            </div>
            <input type="text" class="withdraw-input" id="withdrawAddress" data-lang-placeholder="ton-address" placeholder="Введите TON адрес">
            <input type="number" class="modal-input" id="withdrawAmount" data-lang-placeholder="withdraw-amount" placeholder="Введите сумму для вывода" min="1" step="0.01">
            <div class="modal-buttons">
                <button class="modal-btn confirm" onclick="confirmWithdraw()" data-lang="withdraw">Вывести</button>
                <button class="modal-btn cancel" onclick="closeWithdrawModal()" data-lang="cancel">Отмена</button>
            </div>
        </div>
    </div>

    <!-- Модальное окно аккаунта -->
    <div class="modal-overlay" id="accountModal">
        <div class="modal account-modal">
            <h2 data-lang="my-account">Мой аккаунт</h2>
            <div class="account-info">
                <div class="account-balance" id="accountBalance">1000.00 TON</div>
                <div class="account-buttons">
                    <button class="modal-btn confirm" onclick="showDepositModal(); closeAccountModal()" data-lang="deposit">Пополнить</button>
                    <button class="modal-btn cancel balance-button withdraw" onclick="showWithdrawModal(); closeAccountModal()" data-lang="withdraw">Вывод средств</button>
                </div>
            </div>
            <div class="last-bets">
                <h3 data-lang="last-bets">Последние 3 ставки:</h3>
                <div id="lastBetsList">
                    <div class="bet-item">
                        <span data-lang="bet-amount">Ставка: 10.5 TON</span>
                        <span class="bet-result win">+15.75 TON</span>
                        <div class="current-win-amount">Можно забрать сейчас: 21.0 TON</div>
                    </div>
                    <div class="bet-item">
                        <span data-lang="bet-amount">Ставка: 5.0 TON</span>
                        <span class="bet-result lose">-5.0 TON</span>
                    </div>
                    <div class="bet-item">
                        <span data-lang="bet-amount">Ставка: 20.0 TON</span>
                        <span class="bet-result win">+40.0 TON</span>
                        <div class="current-win-amount">Можно забрать сейчас: 60.0 TON</div>
                    </div>
                </div>
            </div>
            <div class="modal-buttons">
                <button class="modal-btn cancel" onclick="closeAccountModal()" data-lang="close">Закрыть</button>
            </div>
        </div>
    </div>

    <!-- Модальное окно выигрыша -->
    <div class="modal-overlay win-modal-overlay" id="winModal">
        <div class="modal win-modal">
            <h2 data-lang="win-title">Выигрыш!</h2>
            <div class="win-amount" id="winAmountDisplay">
                +0.00 <img src="https://ton.org/download/ton_symbol.png" alt="TON" style="width: 48px; height: 48px; margin-left: 10px;">
            </div>
            <div class="win-multiplier" id="winMultiplierDisplay" data-lang="at-multiplier">при 0.00x</div>
            <div class="modal-buttons">
                <button class="modal-btn confirm" onclick="closeWinModal()" data-lang="great">Отлично!</button>
            </div>
        </div>
    </div>

    <!-- Модальное окно выбора цвета баланса -->
    <div class="modal-overlay color-picker-modal-overlay" id="colorPickerModal">
        <div class="modal color-picker-modal">
            <h2>Выбор цвета баланса</h2>
            <input type="color" class="color-picker" id="colorPicker" value="#ffffff" onchange="updateColorPreview()">
            <div class="color-preview" id="colorPreview">1000.00</div>
            <div class="modal-buttons">
                <button class="modal-btn confirm" onclick="applyBalanceColor()">Применить</button>
                <button class="modal-btn cancel" onclick="closeColorPicker()">Отмена</button>
            </div>
        </div>
    </div>

    <!-- Модальное окно техподдержки -->
    <div class="modal-overlay support-modal-overlay" id="supportModal">
        <div class="modal support-modal">
            <h2>Техническая поддержка</h2>
            <div class="support-chat" id="supportChat">
                <div class="chat-message bot">
                    Добро пожаловать! Я помогу вам с популярными вопросами. Выберите интересующую тему или задайте свой вопрос.
                </div>
            </div>
            <div class="support-input-container">
                <input type="text" class="support-input" id="supportInput" placeholder="Задайте ваш вопрос...">
                <button class="support-send" onclick="sendSupportMessage()">Отправить</button>
            </div>
            <div class="modal-buttons" style="margin-top: 20px;">
                <button class="modal-btn cancel" onclick="closeSupportModal()">Закрыть</button>
            </div>
        </div>
    </div>

    <script>
        // Курсы криптовалют (примерные)
        const exchangeRates = {
            TON: 2.5,    // 1 TON = $2.5
            USDT: 1.0,   // 1 USDT = $1.0
            BTC: 96500   // 1 BTC = $96,500
        };

        // Переменные для пополнения TON
        let depositTimer = null;
        let depositAmount = 0;
        let isInDepositWindow = false;

        // Система переводов
        const translations = {
            ru: {
                'balance': 'Баланс',
                'deposit': 'Пополнить',
                'withdraw': 'Вывод средств',
                'login': 'Войти',
                'online': 'Онлайн',
                'players-online': 'Игроки',
                'total-games': 'Всего игр',
                'win-rate': 'Процент побед',
                'game-history': 'История последних игр',
                'bonus-system': 'Бонусная система',
                'stage-progress': 'Стадия 1 из 5',
                'total-deposits': 'Всего пополнений',
                'bonus-received': 'Получено бонусов',
                'next-bonus': 'Следующий бонус',
                'crash-game': 'Crash',
                'bonus': 'Бонусы',
                'wallet': 'Кошелек',
                'wallet-title': 'Мой кошелек',
                'login-title': 'Вход в игру',
                'enter-nickname': 'Введите ваш ник в Telegram',
                'cancel': 'Отмена',
                'cancel-bet': 'Отменить ставку',
                'place-bet': 'Поставить',
                'auto-cashout': 'Авто-кэшаут при (0 = выключен)',
                'deposit-balance': 'Пополнение баланса',
                'withdraw-balance': 'Вывод средств',
                'withdraw-info': 'Минимальная сумма для вывода: 1 TON',
                'withdraw-fee': 'Комиссия сети: 0.02 TON',
                'ton-address': 'Введите TON адрес',
                'withdraw-amount': 'Введите сумму для вывода',
                'enter-deposit-amount': 'Введите сумму для пополнения',
                'my-account': 'Мой аккаунт',
                'last-bets': 'Последние 3 ставки:',
                'bet-amount': 'Ставка:',
                'close': 'Закрыть',
                'win-title': 'Выигрыш!',
                'at-multiplier': 'при',
                'great': 'Отлично!',
                'cashout': 'Забрать',
                'first-deposit': 'Первое пополнение',
                'second-deposit': 'Второе пополнение',
                'third-deposit': 'Третье пополнение',
                'fourth-deposit': 'Четвертое пополнение',
                'fifth-deposit': 'Пятое пополнение'
            },
            en: {
                'balance': 'Balance',
                'deposit': 'Deposit',
                'withdraw': 'Withdraw',
                'login': 'Login',
                'online': 'Online',
                'players-online': 'Players',
                'total-games': 'Total Games',
                'win-rate': 'Win Rate',
                'game-history': 'Recent Games History',
                'bonus-system': 'Bonus System',
                'stage-progress': 'Stage 1 of 5',
                'total-deposits': 'Total Deposits',
                'bonus-received': 'Bonus Received',
                'next-bonus': 'Next Bonus',
                'crash-game': 'Crash',
                'bonus': 'Bonus',
                'wallet': 'Wallet',
                'wallet-title': 'My Wallet',
                'login-title': 'Login to Game',
                'enter-nickname': 'Enter your Telegram nickname',
                'cancel': 'Cancel',
                'cancel-bet': 'Cancel Bet',
                'place-bet': 'Place bet',
                'auto-cashout': 'Auto-cashout at (0 = disabled)',
                'deposit-balance': 'Deposit Balance',
                'withdraw-balance': 'Withdraw Balance',
                'withdraw-info': 'Minimum withdrawal amount: 1 TON',
                'withdraw-fee': 'Network fee: 0.02 TON',
                'ton-address': 'Enter TON address',
                'withdraw-amount': 'Enter withdrawal amount',
                'enter-deposit-amount': 'Enter deposit amount',
                'my-account': 'My Account',
                'last-bets': 'Last 3 bets:',
                'bet-amount': 'Bet:',
                'close': 'Close',
                'win-title': 'Win!',
                'at-multiplier': 'at',
                'great': 'Great!',
                'cashout': 'Cash out',
                'first-deposit': 'First deposit',
                'second-deposit': 'Second deposit',
                'third-deposit': 'Third deposit',
                'fourth-deposit': 'Fourth deposit',
                'fifth-deposit': 'Fifth deposit'
            }
        };

        let currentLanguage = 'ru';

        function toggleLanguage() {
            currentLanguage = currentLanguage === 'ru' ? 'en' : 'ru';
            updateLanguage();
        }

        function updateLanguage() {
            const switcher = document.getElementById('languageSwitcher');
            switcher.textContent = currentLanguage.toUpperCase();

            // Обновляем все элементы с data-lang
            document.querySelectorAll('[data-lang]').forEach(element => {
                const key = element.getAttribute('data-lang');
                if (translations[currentLanguage][key]) {
                    element.textContent = translations[currentLanguage][key];
                }
            });

            // Обновляем плейсхолдеры
            document.querySelectorAll('[data-lang-placeholder]').forEach(element => {
                const key = element.getAttribute('data-lang-placeholder');
                if (translations[currentLanguage][key]) {
                    element.placeholder = translations[currentLanguage][key];
                }
            });

            // Обновляем бонусную систему
            if (game) {
                game.updateBonusDescriptions();
                game.updateBonusDisplay();
                game.updateWalletDisplay();
            }
        }

        // Функции для модального окна PEPE
        function showPepeWelcomeModal() {
            const modal = document.getElementById('pepeWelcomeModal');
            modal.classList.add('show');
        }

        function closePepeWelcomeModal() {
            const modal = document.getElementById('pepeWelcomeModal');
            modal.classList.remove('show');
        }

        // Функции для техподдержки
        const supportResponses = {
            'пополнение': 'Для пополнения баланса выберите удобный способ: TON, СБП или CryptoPay. После пополнения средства зачисляются автоматически.',
            'вывод': 'Для вывода средств перейдите в раздел "Кошелек" и нажмите "Вывести". Минимальная сумма - 1 TON, комиссия сети - 0.02 TON.',
            'бонус': 'За каждое пополнение вы получаете бонус: первое - 100%, второе - 50%, далее по 10%. Бонусы зачисляются автоматически.',
            'игра': 'Crash - это игра на удачу. Поставьте ставку и заберите выигрыш до того, как график упадет. Чем выше коэффициент, тем больше выигрыш.',
            'проблема': 'При технических проблемах напишите нам напрямую! @suphiex'
        };

        function showSupportModal() {
            const modal = document.getElementById('supportModal');
            modal.classList.add('show');
        }

        function closeSupportModal() {
            const modal = document.getElementById('supportModal');
            modal.classList.remove('show');
        }

        function sendSupportMessage() {
            const input = document.getElementById('supportInput');
            const chat = document.getElementById('supportChat');
            const message = input.value.trim();
            
            if (!message) return;
            
            // Добавляем сообщение пользователя
            const userMessage = document.createElement('div');
            userMessage.className = 'chat-message user';
            userMessage.textContent = message;
            chat.appendChild(userMessage);
            
            // Определяем ответ бота
            let response = 'Напишите нам напрямую! @suphiex';
            
            const lowerMessage = message.toLowerCase();
            for (const [key, value] of Object.entries(supportResponses)) {
                if (lowerMessage.includes(key)) {
                    response = value;
                    break;
                }
            }
            
            // Добавляем ответ бота с задержкой
            setTimeout(() => {
                const botMessage = document.createElement('div');
                botMessage.className = 'chat-message bot';
                botMessage.textContent = response;
                chat.appendChild(botMessage);
                chat.scrollTop = chat.scrollHeight;
            }, 500);
            
            input.value = '';
            chat.scrollTop = chat.scrollHeight;
        }

        // Функция участия в конкурсе
        function participateInContest() {
            window.open('https://t.me/TonBet999', '_blank');
        }

        // Функция для переключения меню
        function toggleMenu() {
            const dropdownMenu = document.getElementById('dropdownMenu');
            dropdownMenu.classList.toggle('show');
        }

        // Закрытие меню при клике вне его
        document.addEventListener('click', function(e) {
            const menuButton = document.getElementById('menuButton');
            const dropdownMenu = document.getElementById('dropdownMenu');
            
            if (!menuButton.contains(e.target) && !dropdownMenu.contains(e.target)) {
                dropdownMenu.classList.remove('show');
            }
        });

        function openCryptoPay() {
            const message = currentLanguage === 'ru' ? 
                'Открывается CryptoPay...' : 
                'Opening CryptoPay...';
            alert(message);
            
            // Открыть ссылку
            window.open('http://t.me/send?start=CQ2pIx3xetpR', '_blank');
        }

        // Функции для выбора цвета баланса
        function showColorPicker() {
            if (!game.isLoggedIn) return;
            
            const modal = document.getElementById('colorPickerModal');
            modal.classList.add('show');
        }

        function closeColorPicker() {
            const modal = document.getElementById('colorPickerModal');
            modal.classList.remove('show');
        }

        function updateColorPreview() {
            const colorPicker = document.getElementById('colorPicker');
            const colorPreview = document.getElementById('colorPreview');
            colorPreview.style.color = colorPicker.value;
        }

        function applyBalanceColor() {
            const colorPicker = document.getElementById('colorPicker');
            const balanceText = document.getElementById('balanceText');
            balanceText.style.color = colorPicker.value;
            closeColorPicker();
        }

        // Функция для копирования адреса
        function copyAddress() {
            const text = "UQCvyMHj2r7Ig73EcbBI3h405uemns12eX49OBW3cVsOEzuW";
            navigator.clipboard.writeText(text).then(function() {
                alert('Адрес скопирован в буфер обмена!');
            });
        }

        // Функция для запуска таймера пополнения
        function startDepositTimer(amount) {
            let timeLeft = 300; // 5 минут
            depositTimer = setInterval(() => {
                if (!isInDepositWindow) {
                    clearInterval(depositTimer);
                    return;
                }
                
                const minutes = Math.floor(timeLeft / 60);
                const seconds = timeLeft % 60;
                const timerDisplay = document.getElementById('timerDisplay');
                if (timerDisplay) {
                    timerDisplay.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                }
                
                timeLeft--;
                
                if (timeLeft < 0) {
                    clearInterval(depositTimer);
                    // Зачислить средства
                    if (game && isInDepositWindow) {
                        game.deposit(amount);
                        closeDepositModal();
                    }
                }
            }, 1000);
        }

        function updateBetInfoDisplay() {
            const betInfoDisplay = document.getElementById('betInfoDisplay');
            if (game && game.isLoggedIn && (game.hasBet || game.nextGameBet)) {
                const betAmount = game.hasBet ? game.betAmount : game.nextGameBetAmount;
                betInfoDisplay.textContent = `Вы поставили: ${betAmount.toFixed(2)} TON`;
                betInfoDisplay.style.display = 'block';
            } else {
                betInfoDisplay.style.display = 'none';
            }
        }

        // Функция отмены ставки
        function cancelBet() {
            if (game && game.nextGameBet) {
                game.cancelBet();
            }
        }

        class CrashGame {
            constructor() {
                this.balance = 1000.00;
                this.gameState = 'waiting';
                this.currentMultiplier = 1.00;
                this.betAmount = 0;
                this.hasBet = false;
                this.nextGameBet = false;
                this.nextGameBetAmount = 0;
                this.nextGameAutoCashout = 0;
                this.autoCashout = 0;
                this.gameHistory = [];
                this.miniHistory = [];
                this.totalGames = 0;
                this.wins = 0;
                this.crashPoint = 0;
                this.gameStartTime = 0;
                this.players = [];
                this.playersGenerated = false;
                this.gameLoopId = null;
                this.currentGifIndex = 0;
                this.gifChangeInterval = null;
                this.countdownInterval = null;
                this.gameTimeout = null;
                this.chartPoints = [];
                this.baseY = 0;
                this.isCrashed = false;
                this.onlineCount = 127;
                this.isLoggedIn = false;
                this.playerNick = '';
                this.userBets = [];
                this.currentWinAmount = 0;
                this.playersRefreshInterval = null;
                
                // Бонусная система
                this.bonusStage = 1;
                this.totalDeposits = 0;
                this.totalBonusReceived = 0;
                this.bonusStages = [
                    { stage: 1, bonus: 100, description: "first-deposit" },
                    { stage: 2, bonus: 50, description: "second-deposit" },
                    { stage: 3, bonus: 10, description: "third-deposit" },
                    { stage: 4, bonus: 10, description: "fourth-deposit" },
                    { stage: 5, bonus: 10, description: "fifth-deposit" }
                ];
                
                // GIF'ы для игрового процесса
                this.gameGifs = [
                    'https://i.postimg.cc/8z9Rz89B/Animated-Ag-ADPls-AAjs4-KUg.gif',
                    'https://i.postimg.cc/KvNFbxKw/Animated-Ag-ADXi0-AAn-Vms-Eg.gif',
                    'https://i.postimg.cc/Jh9CxhgD/Animated-Ag-ADm-Rs-AAs2o-EEs.gif',
                    'https://i.postimg.cc/3wGcKFSN/Animated-Ag-ADERo-AAtixc-Es.gif',
                    'https://i.postimg.cc/W4706DtS/Animated-Ag-ADy-Bk-AAg4-Ei-Eo.gif',
                    'https://i.postimg.cc/Gpw0j9f8/Animated-Ag-ADyxs-AAte-Jk-Us.gif'
                ];
                
                this.initializeGame();
                this.startContinuousGame();
                this.startHeartbeatEffect();
                this.startOnlineCounter();
                this.initializeBonusSystem();
                
                // Показать модальное окно PEPE при инициализации
                setTimeout(() => {
                    showPepeWelcomeModal();
                }, 1000);
            }

            initializeGame() {
                this.updateDisplay();
                this.updateLoginState();
                this.updateWalletDisplay();
            }

            regeneratePlayers() {
                // Сохраняем пользователя если он есть
                const userPlayer = this.players.find(p => p.isUser);
                
                // Генерируем новых игроков
                const newPlayers = [];
                const playersCount = Math.floor(Math.random() * 36) + 25;
                
                for (let i = 0; i < playersCount; i++) {
                    const betAmount = Math.random() * 49.9 + 0.1;
                    const cashoutAt = Math.random() < 0.7 ? 
                        Math.random() * (this.crashPoint * 0.8 - 1.2) + 1.2 : 0;
                    
                    newPlayers.push({
                        name: 'Игрок',
                        bet: betAmount.toFixed(2),
                        cashout: '-',
                        hasCashedOut: false,
                        cashedOutAt: cashoutAt,
                        isUser: false
                    });
                }
                
                // Добавляем пользователя обратно если он был
                if (userPlayer) {
                    newPlayers.unshift(userPlayer);
                }
                
                this.players = newPlayers.sort((a, b) => {
                    if (a.isUser) return -1;
                    if (b.isUser) return 1;
                    return parseFloat(b.bet) - parseFloat(a.bet);
                });
                
                this.updatePlayersDisplay();
            }

            initializeBonusSystem() {
                this.createBonusStages();
                this.updateBonusDisplay();
            }

            updateBonusDescriptions() {
                this.bonusStages.forEach(stage => {
                    stage.description = translations[currentLanguage][stage.description] || stage.description;
                });
            }

            updateWalletDisplay() {
                const walletBalanceMain = document.getElementById('walletBalanceMain');
                const walletBalanceUSD = document.getElementById('walletBalanceUSD');
                const tonBalance = document.getElementById('tonBalance');
                const tonUSD = document.getElementById('tonUSD');
                const usdtBalance = document.getElementById('usdtBalance');
                const usdtUSD = document.getElementById('usdtUSD');
                const btcBalance = document.getElementById('btcBalance');
                const btcUSD = document.getElementById('btcUSD');

                if (walletBalanceMain) {
                    walletBalanceMain.textContent = `${this.balance.toFixed(2)} TON`;
                    const usdValue = (this.balance * exchangeRates.TON).toFixed(2);
                    walletBalanceUSD.textContent = `~ $${usdValue}`;
                }

                if (tonBalance) {
                    tonBalance.textContent = `${this.balance.toFixed(2)} TON`;
                    tonUSD.textContent = `≈ $${(this.balance * exchangeRates.TON).toFixed(2)}`;
                }

                if (usdtBalance) {
                    const usdtAmount = (this.balance * exchangeRates.TON).toFixed(2);
                    usdtBalance.textContent = `${usdtAmount} USDT`;
                    usdtUSD.textContent = `≈ $${usdtAmount}`;
                }

                if (btcBalance) {
                    const btcAmount = (this.balance * exchangeRates.TON / exchangeRates.BTC).toFixed(5);
                    btcBalance.textContent = `${btcAmount} BTC`;
                    btcUSD.textContent = `≈ $${(this.balance * exchangeRates.TON).toFixed(2)}`;
                }
            }

            createBonusStages() {
                const bonusStagesContainer = document.getElementById('bonusStages');
                bonusStagesContainer.innerHTML = '';
                
                this.bonusStages.forEach((stage, index) => {
                    const stageElement = document.createElement('div');
                    stageElement.className = 'bonus-stage';
                    
                    if (this.totalDeposits >= stage.stage) {
                        stageElement.classList.add('completed');
                    } else if (this.totalDeposits + 1 === stage.stage) {
                        stageElement.classList.add('active');
                    }
                    
                    const descriptionKey = Object.keys(translations[currentLanguage]).find(key => 
                        translations[currentLanguage][key] === stage.description
                    );
                    const description = translations[currentLanguage][descriptionKey] || stage.description;
                    
                    stageElement.innerHTML = `
                        <div class="bonus-stage-number">${translations[currentLanguage]['stage-progress'].replace('1 из 5', `${stage.stage}`)}</div>
                        <div class="bonus-percentage">+${stage.bonus}%</div>
                        <div class="bonus-description">${description}</div>
                    `;
                    
                    bonusStagesContainer.appendChild(stageElement);
                });
            }

            updateBonusDisplay() {
                const progressText = document.getElementById('bonusProgressText');
                const progressFill = document.getElementById('bonusProgressFill');
                const totalDepositsEl = document.getElementById('totalDeposits');
                const totalBonusEl = document.getElementById('totalBonus');
                const nextBonusEl = document.getElementById('nextBonusAmount');
                
                progressText.textContent = translations[currentLanguage]['stage-progress'].replace('1', Math.min(this.totalDeposits + 1, 5));
                
                const progressPercent = Math.min((this.totalDeposits / 5) * 100, 100);
                progressFill.style.width = progressPercent + '%';
                
                totalDepositsEl.textContent = this.totalDeposits;
                totalBonusEl.textContent = this.totalBonusReceived.toFixed(2);
                
                const nextStage = this.bonusStages.find(s => s.stage > this.totalDeposits);
                nextBonusEl.textContent = nextStage ? `${nextStage.bonus}%` : 'Max';
                
                this.createBonusStages();
            }

            updateLoginState() {
                const loginOverlay = document.getElementById('loginOverlay');
                const balanceText = document.getElementById('balanceText');
                const balanceButtons = document.getElementById('balanceButtons');
                const gameActionButton = document.getElementById('gameActionButton');
                const cancelBetButton = document.getElementById('cancelBetButton');

                if (this.isLoggedIn) {
                    loginOverlay.style.display = 'none';
                    balanceText.classList.remove('balance-blurred');
                    balanceButtons.style.display = 'flex';
                    gameActionButton.style.display = 'block';
                    this.updateGameActionButton();
                    this.updateCancelBetButton();
                } else {
                    loginOverlay.style.display = 'block';
                    balanceText.classList.add('balance-blurred');
                    balanceButtons.style.display = 'none';
                    gameActionButton.className = 'game-action-button login';
                    gameActionButton.textContent = translations[currentLanguage]['login'];
                    gameActionButton.onclick = () => showLoginModal();
                    cancelBetButton.classList.remove('show');
                }
                
                updateBetInfoDisplay();
            }

            updateCancelBetButton() {
                const cancelBetButton = document.getElementById('cancelBetButton');
                
                if (this.isLoggedIn && this.nextGameBet) {
                    cancelBetButton.classList.add('show');
                } else {
                    cancelBetButton.classList.remove('show');
                }
            }

            updateGameActionButton() {
                if (!this.isLoggedIn) return;
                
                const gameActionButton = document.getElementById('gameActionButton');
                
                if (this.gameState === 'playing' && this.hasBet) {
                    gameActionButton.className = 'game-action-button cashout';
                    gameActionButton.innerHTML = `${translations[currentLanguage]['cashout']} ${this.currentWinAmount.toFixed(2)} <img src="https://ton.org/download/ton_symbol.png" alt="TON" style="width: 20px; height: 20px; margin-left: 5px;">`;
                    gameActionButton.onclick = () => this.cashOut();
                    gameActionButton.style.display = 'block';
                } else if (!this.hasBet && !this.nextGameBet) {
                    gameActionButton.className = 'game-action-button bet';
                    gameActionButton.textContent = translations[currentLanguage]['place-bet'];
                    gameActionButton.onclick = () => showBetModal();
                    gameActionButton.style.display = 'block';
                } else {
                    gameActionButton.style.display = 'none';
                }
            }

            cancelBet() {
                if (this.nextGameBet) {
                    this.balance += this.nextGameBetAmount;
                    this.nextGameBet = false;
                    this.nextGameBetAmount = 0;
                    this.nextGameAutoCashout = 0;
                    
                    console.log('Ставка отменена, деньги возвращены');
                    
                    this.updateDisplay();
                    this.updateGameActionButton();
                    this.updateCancelBetButton();
                    this.updatePlayersDisplay();
                    
                    const message = currentLanguage === 'ru' ? 'Ставка отменена' : 'Bet cancelled';
                    alert(message);
                }
            }

            login(nickname) {
                this.isLoggedIn = true;
                this.playerNick = nickname;
                this.updateLoginState();
                console.log('Пользователь вошел:', nickname);
            }

            startOnlineCounter() {
                setInterval(() => {
                    this.onlineCount = Math.floor(Math.random() * 51) + 110;
                    document.getElementById('onlineCount').textContent = this.onlineCount;
                }, 3000);
            }

            startHeartbeatEffect() {
                setInterval(() => {
                    if (Math.random() < 0.33) { // Увеличена вероятность для каждые 3 секунды
                        const gameCanvas = document.getElementById('gameCanvas');
                        gameCanvas.classList.add('heartbeat');
                        setTimeout(() => {
                            gameCanvas.classList.remove('heartbeat');
                        }, 800);
                    }
                }, 3000); // Каждые 3 секунды
            }

            startContinuousGame() {
                console.log('Запуск непрерывной игры');
                this.startGameLoop();
            }

            generatePlayers() {
                this.players = [];
                const playersCount = Math.floor(Math.random() * 36) + 25;
                
                for (let i = 0; i < playersCount; i++) {
                    const betAmount = Math.random() * 49.9 + 0.1;
                    this.players.push({
                        name: 'Игрок',
                        bet: betAmount.toFixed(2),
                        cashout: '-',
                        hasCashedOut: false,
                        cashedOutAt: 0,
                        isUser: false
                    });
                }
                
                this.players.sort((a, b) => parseFloat(b.bet) - parseFloat(a.bet));
                console.log('Игроки сгенерированы:', this.players.length);
            }

            updatePlayersDisplay() {
                const playersList = document.getElementById('playersList');
                
                // Очищаем список игроков в начале каждой игры
                if (this.gameState === 'countdown') {
                    playersList.innerHTML = '';
                }
                
                this.addUserToPlayersList();
                
                if (this.gameState === 'countdown' && playersList.children.length <= 1) {
                    this.players.forEach((player, index) => {
                        const delay = (index * 5000) / this.players.length;
                        setTimeout(() => {
                            this.addPlayerToDisplay(player, index);
                        }, delay);
                    });
                } else if (this.gameState !== 'countdown') {
                    this.updateExistingPlayers();
                }
            }

            addUserToPlayersList() {
                const playersList = document.getElementById('playersList');
                let userDiv = playersList.querySelector('.player-item.user');
                
                if (this.isLoggedIn && (this.hasBet || this.nextGameBet)) {
                    const userBetAmount = this.hasBet ? this.betAmount : this.nextGameBetAmount;
                    
                    if (!userDiv) {
                        userDiv = document.createElement('div');
                        userDiv.className = 'player-item user';
                        playersList.insertBefore(userDiv, playersList.firstChild);
                    }
                    
                    let displayBet = userBetAmount.toFixed(2);
                    let cashoutDisplay = '-';
                    let currentWinDisplay = '';
                    
                    if (this.gameState === 'playing' && this.hasBet) {
                        const potentialWin = (userBetAmount * this.currentMultiplier).toFixed(2);
                        displayBet = `${userBetAmount.toFixed(2)}`;
                        cashoutDisplay = `${potentialWin}`;
                        currentWinDisplay = `<div class="current-win-amount">Можно забрать сейчас: ${potentialWin} TON</div>`;
                    } else if (this.hasBet || this.nextGameBet) {
                        displayBet = `${userBetAmount.toFixed(2)}`;
                    }
                    
                    userDiv.innerHTML = `
                        <div class="player-info">
                            <div class="player-name">${this.playerNick.substring(0, 8)}</div>
                            <div class="player-bet-info">
                                <div class="player-bet">
                                    ${displayBet} <img src="https://ton.org/download/ton_symbol.png" alt="" style="width: 16px; height: 16px;">
                                </div>
                                <div class="player-cashout">
                                    ${cashoutDisplay}
                                </div>
                            </div>
                        </div>
                        ${currentWinDisplay}
                    `;
                } else if (userDiv) {
                    userDiv.remove();
                }
            }

            updateExistingPlayers() {
                const playersList = document.getElementById('playersList');
                const playerItems = playersList.querySelectorAll('.player-item:not(.user)');
                
                playerItems.forEach((playerDiv, index) => {
                    const player = this.players[index];
                    if (!player) return;
                    
                    let betDisplay = `${player.bet}`;
                    let cashoutDisplay = player.cashout;
                    
                    playerDiv.classList.remove('won', 'lost');
                    
                    if (this.gameState === 'playing' && !player.hasCashedOut) {
                        const potentialWin = (parseFloat(player.bet) * this.currentMultiplier).toFixed(2);
                        cashoutDisplay = `${potentialWin}`;
                    } else if (player.hasCashedOut) {
                        cashoutDisplay = player.cashout;
                        playerDiv.classList.add('won');
                    } else if (this.gameState === 'crashed' && !player.hasCashedOut) {
                        playerDiv.classList.add('lost');
                        cashoutDisplay = '-';
                    }
                    
                    const cashoutElement = playerDiv.querySelector('.player-cashout');
                    const lostElement = playerDiv.querySelector('.player-lost');
                    
                    if (this.gameState === 'crashed' && !player.hasCashedOut) {
                        if (cashoutElement) {
                            cashoutElement.className = 'player-lost';
                            cashoutElement.textContent = '-';
                        }
                    } else {
                        if (lostElement) {
                            lostElement.className = player.hasCashedOut ? 'player-cashout' : 'player-cashout';
                        }
                        if (cashoutElement) {
                            cashoutElement.textContent = cashoutDisplay;
                        }
                    }
                });
            }

            addPlayerToDisplay(player, index) {
                const playersList = document.getElementById('playersList');
                const playerDiv = document.createElement('div');
                playerDiv.className = 'player-item';
                playerDiv.style.animationDelay = `${index * 0.05}s`;
                
                let betDisplay = `${player.bet}`;
                let cashoutDisplay = player.cashout;
                
                playerDiv.innerHTML = `
                    <div class="player-info">
                        <div class="player-name">${player.name}</div>
                        <div class="player-bet-info">
                            <div class="player-bet">
                                ${betDisplay} <img src="https://ton.org/download/ton_symbol.png" alt="" style="width: 16px; height: 16px;">
                            </div>
                            <div class="player-cashout">
                                ${cashoutDisplay}
                            </div>
                        </div>
                    </div>
                `;
                playersList.appendChild(playerDiv);
            }

            startGameLoop() {
                console.log('Начало игрового цикла');
                this.clearAllIntervals();
                this.playersGenerated = false;
                this.generatePlayers(); 
                this.startCountdown();
            }

            clearAllIntervals() {
                if (this.gameLoopId) {
                    cancelAnimationFrame(this.gameLoopId);
                    this.gameLoopId = null;
                }
                if (this.gifChangeInterval) {
                    clearInterval(this.gifChangeInterval);
                    this.gifChangeInterval = null;
                }
                if (this.countdownInterval) {
                    clearInterval(this.countdownInterval);
                    this.countdownInterval = null;
                }
                if (this.gameTimeout) {
                    clearTimeout(this.gameTimeout);
                    this.gameTimeout = null;
                }
            }

            startCountdown() {
                console.log('Начало обратного отсчета');
                this.gameState = 'countdown';
                const countdown = document.getElementById('countdown');
                const countdownNumber = document.getElementById('countdownNumber');
                
                countdown.style.display = 'flex';
                
                this.addMiniHistoryItem('?', 'pending');
                
                if (this.nextGameBet && this.isLoggedIn) {
                    this.betAmount = this.nextGameBetAmount;
                    this.autoCashout = this.nextGameAutoCashout;
                    this.hasBet = true;
                    this.nextGameBet = false;
                    
                    console.log('Активирована ставка на следующую игру:', this.betAmount);
                }
                
                this.updateGameActionButton();
                this.updateCancelBetButton();
                this.updatePlayersDisplay();
                
                let count = 5;
                countdownNumber.textContent = count;
                countdownNumber.style.animation = 'heartbeat 1s ease-in-out';

                this.countdownInterval = setInterval(() => {
                    count--;
                    if (count > 0) {
                        countdownNumber.textContent = count;
                        countdownNumber.style.animation = 'none';
                        setTimeout(() => {
                            countdownNumber.style.animation = 'heartbeat 1s ease-in-out';
                        }, 10);
                    } else {
                        clearInterval(this.countdownInterval);
                        this.countdownInterval = null;
                        countdown.style.display = 'none';
                        this.startGame();
                    }
                }, 1000);
            }

            startGame() {
                console.log('Начало игры');
                this.gameState = 'playing';
                this.currentMultiplier = 1.00;
                this.crashPoint = this.generateCrashPoint();
                this.gameStartTime = Date.now();
                this.currentGifIndex = 0;
                this.chartPoints = [];
                this.isCrashed = false;
                this.currentWinAmount = this.hasBet ? this.betAmount : 0;
                
                console.log('Точка краша:', this.crashPoint);
                
                this.simulatePlayerCashouts();
                
                const gameGif = document.getElementById('gameGif');
                gameGif.src = this.gameGifs[this.currentGifIndex];
                gameGif.classList.add('show');
                gameGif.style.left = '50%';
                gameGif.style.top = '150px';
                gameGif.style.transform = 'translateX(-50%)';
                
                this.gifChangeInterval = setInterval(() => {
                    if (this.gameState === 'playing') {
                        this.currentGifIndex = (this.currentGifIndex + 1) % this.gameGifs.length;
                        gameGif.src = this.gameGifs[this.currentGifIndex];
                    }
                }, 1000);
                
                this.updateGameActionButton();
                this.updateCancelBetButton();
                
                document.getElementById('chartLine').setAttribute('d', '');
                document.getElementById('chartArea').setAttribute('d', '');
                document.getElementById('chartLine').classList.remove('crashed');

                const existingCrash = document.querySelector('.game-crashed');
                if (existingCrash) {
                    existingCrash.remove();
                }

                document.getElementById('multiplier').className = 'multiplier-display';
                document.getElementById('winDisplay').classList.remove('show');

                this.gameLoop();
            }

            simulatePlayerCashouts() {
                this.players.forEach(player => {
                    player.hasCashedOut = false;
                    player.cashedOutAt = 0;
                    player.cashout = '-';
                    
                    if (Math.random() < 0.7) {
                        const maxCashout = Math.max(1.2, this.crashPoint - 0.5);
                        const cashoutPoint = Math.random() * (maxCashout - 1.2) + 1.2;
                        player.cashedOutAt = cashoutPoint;
                    }
                });
            }

            generateCrashPoint() {
                const rand = Math.random();
                if (rand < 0.15) return 1.00 + Math.random() * 0.5;
                if (rand < 0.35) return 1.5 + Math.random() * 1.0;
                if (rand < 0.60) return 2.5 + Math.random() * 2.5;
                if (rand < 0.80) return 5.0 + Math.random() * 5.0;
                if (rand < 0.95) return 10.0 + Math.random() * 15.0;
                return 25.0 + Math.random() * 75.0;
            }

            gameLoop() {
                if (this.gameState !== 'playing' && this.gameState !== 'crashed') {
                    console.log('Игровой цикл остановлен, состояние:', this.gameState);
                    return;
                }

                const elapsed = Date.now() - this.gameStartTime;
                
                if (!this.isCrashed) {
                    this.currentMultiplier = 1.00 + Math.pow(elapsed / 1500, 1.1) * 1.2;
                }

                const multiplierElement = document.getElementById('multiplier');
                multiplierElement.textContent = this.currentMultiplier.toFixed(2) + 'x';

                this.updateTradingChart();

                this.players.forEach(player => {
                    if (!player.hasCashedOut && player.cashedOutAt > 0 && this.currentMultiplier >= player.cashedOutAt) {
                        player.hasCashedOut = true;
                        const winAmount = (parseFloat(player.bet) * player.cashedOutAt).toFixed(2);
                        player.cashout = `${winAmount}`;
                    }
                });

                if (this.hasBet && !this.isCrashed) {
                    this.currentWinAmount = this.betAmount * this.currentMultiplier;
                    this.updateGameActionButton();
                }

                this.updateExistingPlayers();

                if (this.hasBet && this.autoCashout > 0 && this.currentMultiplier >= this.autoCashout && !this.isCrashed) {
                    console.log('Авто-кэшаут сработал при:', this.currentMultiplier);
                    this.cashOut();
                    return;
                }

                if (this.currentMultiplier >= this.crashPoint && !this.isCrashed) {
                    console.log('Краш! Множитель:', this.currentMultiplier, 'Точка краша:', this.crashPoint);
                    this.crashGame();
                    return;
                }

                this.gameLoopId = requestAnimationFrame(() => this.gameLoop());
            }

            updateTradingChart() {
                const svg = document.getElementById('tradingChart');
                const svgRect = svg.getBoundingClientRect();
                const width = 800;
                const height = 500;

                const elapsed = Date.now() - this.gameStartTime;
                
                const x = Math.min((elapsed / 15000) * (width - 100), width - 100) + 50;
                
                const multiplierProgress = Math.min((this.currentMultiplier - 1.00) / 19.0, 1.0);
                const smoothProgress = Math.pow(multiplierProgress, 0.4);
                const y = Math.max(height - 50 - (smoothProgress * (height - 150)), 50);
                
                this.chartPoints.push({ x: x, y: y });

                if (this.chartPoints.length > 300) {
                    this.chartPoints.shift();
                }

                let linePath = '';
                let areaPath = '';
                
                if (this.chartPoints.length > 0) {
                    linePath = `M ${this.chartPoints[0].x} ${this.chartPoints[0].y}`;
                    areaPath = `M ${this.chartPoints[0].x} ${height - 50}`;
                    areaPath += ` L ${this.chartPoints[0].x} ${this.chartPoints[0].y}`;
                    
                    for (let i = 1; i < this.chartPoints.length; i++) {
                        linePath += ` L ${this.chartPoints[i].x} ${this.chartPoints[i].y}`;
                        areaPath += ` L ${this.chartPoints[i].x} ${this.chartPoints[i].y}`;
                    }
                    
                    const lastPoint = this.chartPoints[this.chartPoints.length - 1];
                    areaPath += ` L ${lastPoint.x} ${height - 50} Z`;
                }

                document.getElementById('chartLine').setAttribute('d', linePath);
                document.getElementById('chartArea').setAttribute('d', areaPath);
            }

            crashGame() {
                console.log('Игра разбилась при множителе:', this.crashPoint);
                this.gameState = 'crashed';
                this.isCrashed = true;
                
                this.clearAllIntervals();
                
                const gameGif = document.getElementById('gameGif');
                gameGif.classList.remove('show');
                
                document.getElementById('chartLine').classList.add('crashed');
                
                const gameCanvas = document.getElementById('gameCanvas');
                const crashMessage = document.createElement('div');
                crashMessage.className = 'game-crashed';
                crashMessage.textContent = `${currentLanguage === 'ru' ? 'Краш!' : 'Crash!'} ${this.crashPoint.toFixed(2)}x`;
                gameCanvas.appendChild(crashMessage);

                document.getElementById('multiplier').className = 'multiplier-display red';

                this.updateMiniHistoryWithResult(this.crashPoint);

                if (this.hasBet) {
                    const result = {
                        bet: this.betAmount,
                        multiplier: this.crashPoint,
                        result: 'lose',
                        amount: -this.betAmount
                    };
                    this.userBets.unshift(result);
                    if (this.userBets.length > 3) this.userBets.pop();
                    
                    this.gameHistory.push({ multiplier: this.crashPoint, win: false, bet: this.betAmount });
                    this.hasBet = false;
                    this.currentWinAmount = 0;
                    
                    console.log('Игрок проиграл ставку:', this.betAmount);
                } else {
                    this.gameHistory.push({ multiplier: this.crashPoint, win: null, bet: 0 });
                }

                this.totalGames++;
                this.updateDisplay();
                this.updateGameActionButton();
                this.updateCancelBetButton();
                this.updateExistingPlayers();

                if (this.gameHistory.length > 10) {
                    this.gameHistory = this.gameHistory.slice(-10);
                }

                console.log('Запуск следующей игры через 3 секунды');
                this.gameTimeout = setTimeout(() => {
                    this.startGameLoop();
                }, 3000);
            }

            addMiniHistoryItem(value, type) {
                const miniHistory = document.getElementById('gameHistoryMini');
                const item = document.createElement('div');
                item.className = `mini-result ${type}`;
                item.textContent = value;
                
                miniHistory.appendChild(item);
                
                while (miniHistory.children.length > 5) {
                    miniHistory.removeChild(miniHistory.firstChild);
                }
            }

            updateMiniHistoryWithResult(multiplier) {
                const miniHistory = document.getElementById('gameHistoryMini');
                const pendingItem = miniHistory.querySelector('.pending');
                
                if (pendingItem) {
                    pendingItem.textContent = multiplier.toFixed(2) + 'x';
                    pendingItem.classList.remove('pending');
                    
                    if (multiplier < 1.5) {
                        pendingItem.classList.add('red');
                    } else if (multiplier < 3.0) {
                        pendingItem.classList.add('orange');
                    } else {
                        pendingItem.classList.add('white');
                    }
                }
            }

            placeBet(amount, autoCashout) {
                if (!this.isLoggedIn) {
                    showLoginModal();
                    return false;
                }
                
                console.log('Попытка поставить ставку:', amount, 'Состояние игры:', this.gameState);
                
                if (amount <= 0 || amount > this.balance) {
                    alert(currentLanguage === 'ru' ? 'Неверная сумма ставки!' : 'Invalid bet amount!');
                    return false;
                }

                if (this.gameState === 'countdown' || this.gameState === 'waiting' || this.gameState === 'crashed') {
                    if (this.gameState === 'countdown') {
                        this.betAmount = amount;
                        this.balance -= amount;
                        this.hasBet = true;
                        this.currentWinAmount = amount;
                        this.autoCashout = autoCashout || 0;
                        
                        console.log('Ставка на текущую игру принята:', this.betAmount);
                    } else {
                        this.nextGameBet = true;
                        this.nextGameBetAmount = amount;
                        this.nextGameAutoCashout = autoCashout || 0;
                        this.balance -= amount;
                        console.log('Ставка на следующую игру зарезервирована:', this.nextGameBetAmount);
                    }
                } else {
                    this.nextGameBet = true;
                    this.nextGameBetAmount = amount;
                    this.nextGameAutoCashout = autoCashout || 0;
                    this.balance -= amount;
                    console.log('Ставка на следующую игру зарезервирована во время игры:', this.nextGameBetAmount);
                }
                
                this.updateDisplay();
                this.updateGameActionButton();
                this.updateCancelBetButton();
                this.updatePlayersDisplay();
                return true;
            }

            cashOut() {
                if (!this.isLoggedIn || this.gameState !== 'playing' || !this.hasBet) return;
                
                const winAmount = this.betAmount * this.currentMultiplier;
                this.balance += winAmount;
                
                const result = {
                    bet: this.betAmount,
                    multiplier: this.currentMultiplier,
                    result: 'win',
                    amount: winAmount
                };
                this.userBets.unshift(result);
                if (this.userBets.length > 3) this.userBets.pop();
                
                this.showWinModal(winAmount, this.currentMultiplier);
                
                this.gameHistory.push({ 
                    multiplier: this.currentMultiplier, 
                    win: true, 
                    bet: this.betAmount,
                    winAmount: winAmount 
                });
                
                this.wins++;
                
                this.hasBet = false;
                this.betAmount = 0;
                this.currentWinAmount = 0;
                
                console.log('Кэшаут! Выиграно:', winAmount);
                
                document.getElementById('balance').classList.add('pulse-animation');
                setTimeout(() => {
                    document.getElementById('balance').classList.remove('pulse-animation');
                }, 500);
                
                this.updateDisplay();
                this.updateGameActionButton();
                this.updateCancelBetButton();
                this.updatePlayersDisplay();
            }

            showWinModal(winAmount, multiplier) {
                const winModal = document.getElementById('winModal');
                const winAmountDisplay = document.getElementById('winAmountDisplay');
                const winMultiplierDisplay = document.getElementById('winMultiplierDisplay');
                
                winAmountDisplay.innerHTML = `+${winAmount.toFixed(2)} <img src="https://ton.org/download/ton_symbol.png" alt="TON" style="width: 48px; height: 48px; margin-left: 10px;">`;
                winMultiplierDisplay.textContent = `${translations[currentLanguage]['at-multiplier']} ${multiplier.toFixed(2)}x`;
                
                winModal.classList.add('show');
            }

            closeWinModal() {
                const winModal = document.getElementById('winModal');
                winModal.classList.remove('show');
            }

            updateDisplay() {
                const balanceEl = document.getElementById('balanceText');
                balanceEl.textContent = this.balance.toFixed(2);
                
                document.getElementById('totalGames').textContent = this.totalGames;
                document.getElementById('winRate').textContent = this.totalGames > 0 ? 
                    Math.round((this.wins / this.totalGames) * 100) + '%' : '0%';
                
                this.updateHistory();
                this.updateWalletDisplay();
                updateBetInfoDisplay();
                
                const accountBalance = document.getElementById('accountBalance');
                if (accountBalance) {
                    accountBalance.textContent = `${this.balance.toFixed(2)} TON`;
                }
            }

            updateHistory() {
                const historyList = document.getElementById('historyList');
                historyList.innerHTML = '';
                
                this.gameHistory.slice().reverse().forEach(game => {
                    const item = document.createElement('div');
                    item.className = `history-item ${game.win === true ? 'win' : game.win === false ? 'lose' : 'neutral'}`;
                    
                    if (game.win === true) {
                        item.textContent = `${game.multiplier.toFixed(2)}x ✓`;
                    } else if (game.win === false) {
                        item.textContent = `${game.multiplier.toFixed(2)}x ✗`;
                    } else {
                        item.textContent = `${game.multiplier.toFixed(2)}x`;
                        item.style.background = 'rgba(102, 204, 255, 0.2)';
                        item.style.color = '#66ccff';
                    }
                    
                    historyList.appendChild(item);
                });
            }

            updateLastBets() {
                const lastBetsList = document.getElementById('lastBetsList');
                if (lastBetsList && this.userBets.length > 0) {
                    lastBetsList.innerHTML = '';
                    
                    this.userBets.forEach(bet => {
                        const betItem = document.createElement('div');
                        betItem.className = 'bet-item';
                        
                        const resultClass = bet.result === 'win' ? 'win' : 'lose';
                        const resultText = bet.result === 'win' ? 
                            `+${bet.amount.toFixed(2)} TON` : 
                            `${bet.amount.toFixed(2)} TON`;
                        
                        let currentWinDisplay = '';
                        if (bet.result === 'win') {
                            const currentPotential = (bet.bet * this.currentMultiplier).toFixed(2);
                            currentWinDisplay = `<div class="current-win-amount">Можно забрать сейчас: ${currentPotential} TON</div>`;
                        }
                        
                        betItem.innerHTML = `
                            <span>${translations[currentLanguage]['bet-amount']} ${bet.bet.toFixed(2)} TON (${bet.multiplier.toFixed(2)}x)</span>
                            <span class="bet-result ${resultClass}">${resultText}</span>
                            ${currentWinDisplay}
                        `;
                        
                        lastBetsList.appendChild(betItem);
                    });
                }
            }

            deposit(amount) {
                if (!this.isLoggedIn) return;
                
                this.balance += amount;
                this.totalDeposits++;
                
                let bonusPercent = 0;
                if (this.totalDeposits === 1) {
                    bonusPercent = 100;
                } else if (this.totalDeposits === 2) {
                    bonusPercent = 50;
                } else if (this.totalDeposits <= 5) {
                    bonusPercent = 10;
                }
                
                if (bonusPercent > 0) {
                    const bonusAmount = amount * (bonusPercent / 100);
                    this.balance += bonusAmount;
                    this.totalBonusReceived += bonusAmount;
                    
                    const message = currentLanguage === 'ru' ? 
                        `Баланс пополнен на ${amount.toFixed(2)} TON!\nБонус: +${bonusAmount.toFixed(2)} TON (${bonusPercent}%)` :
                        `Balance replenished by ${amount.toFixed(2)} TON!\nBonus: +${bonusAmount.toFixed(2)} TON (${bonusPercent}%)`;
                    alert(message);
                } else {
                    const message = currentLanguage === 'ru' ? 
                        `Баланс пополнен на ${amount.toFixed(2)} TON!` :
                        `Balance replenished by ${amount.toFixed(2)} TON!`;
                    alert(message);
                }
                
                this.updateDisplay();
                this.updateBonusDisplay();
            }

            withdraw(amount, address) {
                if (!this.isLoggedIn) return false;
                
                const minWithdraw = 1;
                const networkFee = 0.02;
                const totalRequired = amount + networkFee;
                
                if (amount < minWithdraw) {
                    const message = currentLanguage === 'ru' ? 
                        `Минимальная сумма для вывода: ${minWithdraw} TON` :
                        `Minimum withdrawal amount: ${minWithdraw} TON`;
                    alert(message);
                    return false;
                }
                
                if (totalRequired > this.balance) {
                    const message = currentLanguage === 'ru' ? 
                        'Недостаточно средств для вывода (включая комиссию сети)' :
                        'Insufficient balance for withdrawal (including network fee)';
                    alert(message);
                    return false;
                }
                
                this.balance -= totalRequired;
                
                const message = currentLanguage === 'ru' ? 
                    `Заявка на вывод ${amount.toFixed(2)} TON отправлена!\nКомиссия сети: ${networkFee} TON\nАдрес: ${address}` :
                    `Withdrawal request for ${amount.toFixed(2)} TON submitted!\nNetwork fee: ${networkFee} TON\nAddress: ${address}`;
                alert(message);
                
                this.updateDisplay();
                return true;
            }
        }

        let game;
        let currentSlide = 0;

        function switchToSlide(slideIndex) {
            const sliderContainer = document.getElementById('sliderContainer');
            const crashBtn = document.getElementById('crashBtn');
            const bonusBtn = document.getElementById('bonusBtn');
            const walletBtn = document.getElementById('walletBtn');
            
            currentSlide = slideIndex;
            sliderContainer.style.transform = `translateX(-${slideIndex * 33.333}%)`;
            
            crashBtn.classList.remove('active');
            bonusBtn.classList.remove('active');
            walletBtn.classList.remove('active');
            
            if (slideIndex === 0) {
                crashBtn.classList.add('active');
            } else if (slideIndex === 1) {
                bonusBtn.classList.add('active');
            } else if (slideIndex === 2) {
                walletBtn.classList.add('active');
            }
        }

        function showLoginModal() {
            const modal = document.getElementById('loginModal');
            const input = document.getElementById('telegramNick');
            
            input.value = '';
            modal.classList.add('show');
            input.focus();
        }

        function closeLoginModal() {
            const modal = document.getElementById('loginModal');
            modal.classList.remove('show');
        }

        function login() {
            const nickname = document.getElementById('telegramNick').value.trim();
            if (nickname.length < 2) {
                const message = currentLanguage === 'ru' ? 'Введите корректный ник!' : 'Enter a valid nickname!';
                alert(message);
                return;
            }
            
            game.login(nickname);
            closeLoginModal();
        }

        function showBetModal() {
            if (!game.isLoggedIn) {
                showLoginModal();
                return;
            }
            
            const modal = document.getElementById('betModal');
            const input = document.getElementById('betAmountInput');
            
            input.value = '0.10';
            modal.classList.add('show');
            input.focus();
        }

        function closeBetModal() {
            const modal = document.getElementById('betModal');
            modal.classList.remove('show');
        }

        function setBetAmountModal(amount) {
            document.getElementById('betAmountInput').value = amount.toFixed(2);
        }

        function doubleBetModal() {
            const current = parseFloat(document.getElementById('betAmountInput').value) || 0;
            const doubled = (current * 2).toFixed(2);
            document.getElementById('betAmountInput').value = doubled;
        }

        function confirmBet() {
            const amount = parseFloat(document.getElementById('betAmountInput').value);
            const autoCashout = parseFloat(document.getElementById('autoCashoutInput').value) || 0;
            
            if (amount && amount > 0 && game.placeBet(amount, autoCashout)) {
                closeBetModal();
            } else {
                const message = currentLanguage === 'ru' ? 'Введите корректную сумму!' : 'Enter a valid amount!';
                alert(message);
            }
        }

        let selectedDepositCurrency = '';

        function showDepositModal() {
            if (!game.isLoggedIn) {
                showLoginModal();
                return;
            }
            
            const modal = document.getElementById('depositModal');
            const input = document.getElementById('depositAmount');
            const depositButtons = document.getElementById('depositButtons');
            const tonDepositInfo = document.getElementById('tonDepositInfo');
            
            input.value = '';
            depositButtons.style.display = 'flex';
            tonDepositInfo.style.display = 'none';
            selectedDepositCurrency = '';
            isInDepositWindow = true;
            
            modal.classList.add('show');
        }

        function closeDepositModal() {
            const modal = document.getElementById('depositModal');
            modal.classList.remove('show');
            isInDepositWindow = false;
            
            if (depositTimer) {
                clearInterval(depositTimer);
                depositTimer = null;
            }
        }

        function showWithdrawModal() {
            if (!game.isLoggedIn) {
                showLoginModal();
                return;
            }
            
            const modal = document.getElementById('withdrawModal');
            const addressInput = document.getElementById('withdrawAddress');
            const amountInput = document.getElementById('withdrawAmount');
            
            addressInput.value = '';
            amountInput.value = '';
            modal.classList.add('show');
            addressInput.focus();
        }

        function closeWithdrawModal() {
            const modal = document.getElementById('withdrawModal');
            modal.classList.remove('show');
        }

        function confirmWithdraw() {
            const address = document.getElementById('withdrawAddress').value.trim();
            const amount = parseFloat(document.getElementById('withdrawAmount').value);
            
            if (!address) {
                const message = currentLanguage === 'ru' ? 'Введите TON адрес!' : 'Enter TON address!';
                alert(message);
                return;
            }
            
            if (!amount || amount <= 0) {
                const message = currentLanguage === 'ru' ? 'Введите корректную сумму!' : 'Enter a valid amount!';
                alert(message);
                return;
            }
            
            if (game.withdraw(amount, address)) {
                closeWithdrawModal();
            }
        }

        function depositCurrency(currency) {
            selectedDepositCurrency = currency;
            if (currency === 'SBP') {
                // Открыть ссылку на CryptoBot
                window.open('https://t.me/CryptoBot', '_blank');
            }
        }

        function confirmDeposit() {
            const amount = parseFloat(document.getElementById('depositAmount').value);
            if (!amount || amount <= 0) {
                const message = currentLanguage === 'ru' ? 'Введите корректную сумму!' : 'Enter a valid amount!';
                alert(message);
                return;
            }

            if (selectedDepositCurrency === 'TON') {
                // Показать QR-код и запустить таймер
                const depositButtons = document.getElementById('depositButtons');
                const tonDepositInfo = document.getElementById('tonDepositInfo');
                
                depositButtons.style.display = 'none';
                tonDepositInfo.style.display = 'block';
                
                depositAmount = amount;
                startDepositTimer(amount);
            } else {
                game.deposit(amount);
                closeDepositModal();
            }
        }

        function showAccountModal() {
            if (!game.isLoggedIn) {
                showLoginModal();
                return;
            }
            
            const modal = document.getElementById('accountModal');
            game.updateLastBets();
            modal.classList.add('show');
        }

        function closeAccountModal() {
            const modal = document.getElementById('accountModal');
            modal.classList.remove('show');
        }

        function closeWinModal() {
            if (game) game.closeWinModal();
        }

        // Поддержка ввода по Enter в чате поддержки
        document.addEventListener('keypress', function(e) {
            if (e.target.id === 'supportInput' && e.key === 'Enter') {
                sendSupportMessage();
            }
        });

        // Закрытие модальных окон по клику вне их
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('modal-overlay')) {
                e.target.classList.remove('show');
                
                // Если это модальное окно пополнения, сбросить состояние
                if (e.target.id === 'depositModal') {
                    isInDepositWindow = false;
                    if (depositTimer) {
                        clearInterval(depositTimer);
                        depositTimer = null;
                    }
                }
            }
        });

        // Вход по Enter в модальном окне логина
        document.getElementById('telegramNick').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                login();
            }
        });

        // Ставка по Enter в модальном окне ставки
        document.getElementById('betAmountInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                confirmBet();
            }
        });

        // Пополнение по Enter
        document.getElementById('depositAmount').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                confirmDeposit();
            }
        });

        // Вывод по Enter
        document.getElementById('withdrawAmount').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                confirmWithdraw();
            }
        });

        // Инициализация игры
        document.addEventListener('DOMContentLoaded', function() {
            game = new CrashGame();
            updateLanguage();
        });
    </script>
</body>
</html>
